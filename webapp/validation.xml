<?xml version="1.0" encoding="UTF-8"?>
<book>
    <bookinfo>
        <graphic fileref="logo.jpg"/>
        <productname>Open Source Native XML Database</productname>
        <title>XML Validation</title>
        <author>
            <firstname>Dannes</firstname>
            <surname>Wessels</surname>
            <affiliation>
                <address format="linespecific">
                    <email>dizzzz at exist-db.org</email>
                </address>
            </affiliation>
        </author>
    </bookinfo>

    <ci:include xmlns:ci="http://apache.org/cocoon/include/1.0" src="sidebar.xml"/>

    <chapter>
        <title>XML Validation</title>
        <section id="sect1">
            <title>Introduction</title>
            <para>The database supports validation of XML in two different ways. The first one is
                automagic validation of XML documents while they are inserted into the database, the
                second way is validation of XML documents (either stored in database or in
                constructed memory) using an xquery extension function. </para>
        </section>
        <section id="sect2">
            <title>Configuration</title>
            <para>In the eXist-db configuration file <filename>conf.xml</filename> the following
                items can be configured: <itemizedlist>
                    <listitem>
                        <para>Validation mode</para>
                    </listitem>

                    <listitem>
                        <para>System catalog</para>
                    </listitem>
                </itemizedlist>
            </para>
            <para>
                <example>
                    <title>Default configuration</title>
                    <programlisting format="linespecific"><![CDATA[
    <validation mode="auto">
        <entity-resolver>
            <catalog uri="${WEBAPP_HOME}/WEB-INF/catalog.xml" />
        </entity-resolver>
    </validation>
                ]]></programlisting>
                </example>
            </para>

            <section>
                <title>Validation mode</title>
                <para>With the parameter <emphasis>mode</emphasis> it is possible to switch on/off
                    the validation capabilities of the (Xerces) XML parser, which is used when a
                    document is inserted into the database. The possible values are:</para>
                <section>
                    <title>yes</title>
                    <para>Switch on validation. All XML documents will be validated, if there is no
                        grammar (XML schema, DTD) the document will be rejected.</para>
                </section>
                <section>
                    <title>no</title>
                    <para>Switch off validation. All well-formed XML documents will be
                    accepted.</para>
                </section>
                <section>
                    <title>auto (default)</title>
                    <para>Validation of an XML document will be performed based on the contents of
                        the document. When a document contains a reference to a grammar (XML schema
                        or DTD), the parser tries to resolve this grammar and the XML document will
                        be validated against this grammar, like <emphasis>mode="yes"</emphasis>. If
                        the grammar cannot be resolved, the XML document is rejected. When the XML
                        document does not contain a reference to a grammar, it will be parsed like
                            <emphasis>mode="no"</emphasis>.</para>
                </section>
            </section>


            <section>
                <title>System Catalog</title>
            </section>



            <para>Bla <ulink url="http://link#aa">txt</ulink> bla de bla <filename>.jar</filename>
                bladibla.</para>
            <para>Once the download has completed, start the eXist installation by doing
                    <emphasis>ONE</emphasis> of the following:</para>
            <procedure>
                <step>
                    <para>Bla bla: <filename> eXist-[version]-build-XXXX.jar</filename></para>
                </step>
                <step>
                    <para>Bla bla <command>-jar</command> option:</para>
                </step>
            </procedure>
            <synopsis format="linespecific">java -jar eXist-[Version].jar</synopsis>

            <para>This will launch the installer. Simply follow the steps to complete the
                installation process.</para>
            <note>
                <para>Bladibla.</para>
            </note>
        </section>

        <section id="sect3">
            <title>Validation while inserting documents</title>
        </section>

        <section id="sect4">
            <title>xQuery extension functions</title>
        </section>

        <section>
            <title>XML instance examples</title>
            <para>
                <example>
                    <title>namespace</title>
                    <programlisting format="linespecific"><![CDATA[
<?xml version='1.0'?>
<addressBook xmlns="http://jmvanel.free.fr/xsd/addressBook">
    .....
</addressBook>]]></programlisting>
                </example>

                <example>
                    <title>schemaLocation</title>
                    <programlisting format="linespecific"><![CDATA[
<?xml version='1.0'?>
<addressBook xsi:schemaLocation="http://jmvanel.free.fr/xsd/addressBook http://myshost/schema.xsd" 
             xmlns="http://jmvanel.free.fr/xsd/addressBook" 
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    .....
</addressBook>]]></programlisting>
                </example>

                <example>
                    <title>noNamespaceSchemaLocation</title>
                    <para>Taken from: conf.xml</para>
                    <programlisting format="linespecific"><![CDATA[
<?xml version='1.0'?>
<exist xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
       xsi:noNamespaceSchemaLocation="schema/conf.xsd">
    .....
</exist>]]></programlisting>
                </example>

                <example>
                    <title>DTD DOCTYPE</title>
                    <para>Taken from 'samples/validation/dtd'.</para>
                    <programlisting format="linespecific"><![CDATA[
<?xml version='1.0'?>
<!DOCTYPE PLAY PUBLIC "-//VALIDATION//EN" "hamlet.dtd">
<PLAY>
...
</PLAY>]]></programlisting>
                </example>

            </para>


        </section>
    </chapter>
</book>
