<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id$ -->
<book>
    <bookinfo>
        <graphic fileref="logo.jpg"/>
        <productname>Open Source Native XML Database</productname>
        <title>Using WebDAV to Access the Database</title>
        <date>September 2009</date>
        <author>
            <firstname>Dannes</firstname>
            <surname>Wessels</surname>
            <affiliation>
                <address format="linespecific">
                    <email>dizzzz@exist-db.org</email>
                </address>
            </affiliation>
        </author>
    </bookinfo>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="sidebar.xml"/>
    <chapter id="webdav">
        <title>WebDAV</title>

        <section id="webdav">
            <title>Introducing WebDAV</title>
            <para>Beginning with version 1.0b2, eXist is shipped with its own implementation of a <ulink
                    url="http://en.wikipedia.org/wiki/WebDAV">WebDAV</ulink> HTTP interface. <ulink
                    url="http://en.wikipedia.org/wiki/WebDAV">WebDAV</ulink> makes it possible to manage database
                collections and documents in eXist-db just like directories and files in a file system. You may copy,
                move, delete, view or edit files with any application supporting the WebDAV protocol, including Windows
                Explorer , MacOsX Finder , <ulink url="http://www.webdav.org/cadaver">cadaver</ulink>, <ulink
                    url="http://www.konqueror.org/">KDE Konqueror</ulink>, <ulink url="http://www.oxygenxml.com/"
                    >OxygenXML</ulink>, <ulink url="http://www.altova.com/">XML Spy</ulink>, <ulink
                    url="http://www.openoffice.org/">OpenOffice.org</ulink> and many others.</para>

            <para>The WebDAV feature is implemented using the excellent open-source server-side <ulink
                    url="http://milton.ettrema.com/">Milton</ulink> webdav API for java. In the default configuration
                the WebDAV server can be accessed via the URLs <ulink url="http://localhost:8080/exist/webdav/db/"
                    >http://localhost:8080/exist/webdav/db/</ulink> and <ulink
                    url="https://localhost:8443/exist/webdav/db/">https://localhost:8443/exist/webdav/db/</ulink>.
            </para>
        </section>

        <section id="compatibility">
            <title>Compatibility</title>
            <para>The <ulink url="http://milton.ettrema.com/">Milton</ulink> project maintains a detailed webdav client
                    <ulink url="http://milton.ettrema.com/compat/">compatibility list</ulink> that describes a "Recipe
                for broad client compatibility". In case of problems please read this document. Some additional remarks
                can be made however:</para>
            <itemizedlist>
                <listitem>
                    <para>The Milton/eXist-db interface does not support HTTP Digest Authentication, in contrast to the
                        original implementation.</para>
                </listitem>
                <listitem>
                    <para>The size of an XML document is presented as a plural of 4096 bytes, which is the eXist-db
                        internal pagesize (see <ulink url="configuration.xml#conf.xml">conf.xml</ulink>). The actual
                        size can not be determined because the size depends on many factors, e.g. the applied
                        serialization parameters.</para>
                </listitem>
                <listitem>
                    <para>It turns out that some WebDAV clients can not handle this size estimation. A workaround has
                        been implemented to help some clients, but in some cases this doesn't seem to be sufficient.
                    </para>
                </listitem>
            </itemizedlist>

            <para>The WebDAV interface has been successfully tested with: Windows Webfolders (Windows XP/7), <ulink
                    url="http://www.jscape.com/products/file-transfer-clients/anyclient/">AnyClient</ulink>, MacOsX
                Finder, <ulink url="http://www.panic.com/transmit/">Transmit</ulink> (MacOsX), DavFs2 rev1.4.5 (linux)
                and OpenOffice.org</para>
            <para>The following clients are reported to have issues: <ulink url="http://en.wikipedia.org/wiki/GVFS"
                    >GVFS</ulink> (Nautilus) and <ulink url="http://www.netdrive.net/">NetDrive</ulink>.</para>
        </section>

        <section id="clients">
            <title>Clients</title>
            <section>
                <title>Windows Webfolder</title> Out of the box Windows (XP, 7) has 'some' native support for the WebDAV
                protocol, but there are some wellknown issues. Please consult the articles in case of problems.<note>
                    <para>Be aware that there are multiple versions of webdav Microsoft libraries (and different
                        flavours of bugs). To avoid some frustration if the steps below don't work for you, <ulink
                            url="http://support.microsoft.com/?kbid=892211">update windows XP for web folders</ulink>,
                        or take more information about <ulink
                            url="http://greenbytes.de/tech/webdav/webfolder-client-list.html">Web Folder Client
                            (MSDAIPP.DLL) Versions and Issues</ulink>.</para>
                </note>
                <note>
                    <para>Windows Vista and Windows 7 both restrict access to webdav servers that use Basic HTTP
                        authentication on non-SSL connections. This restriction can be solved by changing a registry
                        key. Read more on <ulink url="http://support.microsoft.com/kb/841215">MSDN</ulink> and <ulink
                            url="http://greenbytes.de/tech/webdav/webdav-redirector-list.html">greenbytes.de</ulink>.
                    </para>
                </note>
                <para>Perform the following steps in Internet Explorer: <itemizedlist>
                        <listitem>
                            <para>Select <command>File -&gt; Open</command>.</para>
                        </listitem>
                        <listitem>
                            <para>Fill in URL like <command>http://localhost:8080/exist/webdav/db/</command> or
                                    <command>https://localhost:8443/exist/webdav/db/</command>.</para>
                        </listitem>
                        <listitem>
                            <para>Check "Open as Web Folder".</para>
                        </listitem>
                        <listitem>
                            <para>Click OK.</para>
                        </listitem>
                    </itemizedlist>
                    <screenshot>
                        <graphic fileref="resources/webdav_xp_webfolders.png"/>
                    </screenshot>
                </para>
            </section>

            <section>
                <title>WinXP My Network Places</title>

                <para>This enables you to access eXist from almost any windowsXP application that supports 'Network
                    Places' in the standard File dialog: <screenshot>
                        <graphic fileref="resources/webdav_xp_mnp0.png"/>
                    </screenshot>
                </para>
                <para>First, go to "My Network Places", click "Add.." <screenshot>
                        <graphic fileref="resources/webdav_xp_mnp1.png"/>
                    </screenshot>
                </para>
                <para>Then select the service provider. <screenshot>
                        <graphic fileref="resources/webdav_xp_mnp2.png"/>
                    </screenshot>
                </para>
                <para>Then fill the URL of exist e.g. http://localhost:8080/exist/webdav/db/. <screenshot>
                        <graphic fileref="resources/webdav_xp_mnp3.png"/>
                    </screenshot>
                </para>
                <para>Finally click on icon to access eXist. <screenshot>
                        <graphic fileref="resources/webdav_xp_mnp4.png"/>
                    </screenshot>
                </para>

            </section>

            <section>
                <title>MacOsX Finder</title>
                <para>The eXist database can be accessed easily with the MacOsX Finder. First select in the Finder "Go"
                    and "Connect to Server..." <screenshot>
                        <graphic fileref="resources/webdav_macosx_1.png"/>
                    </screenshot>
                </para>
                <para>Fill in the webdav url http://localhost:8080/exist/webdav/db/ <screenshot>
                        <graphic fileref="resources/webdav_macosx_2.png"/>
                    </screenshot>
                </para>
                <para>Enter username and password... <screenshot>
                        <graphic fileref="resources/webdav_macosx_3.png"/>
                    </screenshot>
                </para>
                <para>And the database is accessible! <screenshot>
                        <graphic fileref="resources/webdav_macosx_4.png"/>
                    </screenshot>
                </para>
            </section>


            <section>
                <title>OxygenXML</title>

                <para>
                    <itemizedlist>
                        <listitem>
                            <para>Select <command>File -&gt; Open URL</command>.</para>
                        </listitem>
                        <listitem>
                            <para>Fill <command>User</command> and <command>Password</command>.</para>
                        </listitem>
                        <listitem>
                            <para>Enter <command>Server Url</command> http://localhost:8080/exist/webdav/db/.</para>
                        </listitem>
                        <listitem>
                            <para>Click <command>Browse</command>.</para>
                        </listitem>
                    </itemizedlist>
                    <screenshot>
                        <graphic fileref="resources/webdav_oxygen.png"/>
                    </screenshot>
                </para>
                <note>
                    <para>Note on SSL; Probably you'll get the message: Error:
                        sun.security.validator.ValidatorException: PKIX path building failed:
                        sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification
                        path to requested target.</para>
                    <para>You'll need to add the Server certificate to your trusted certificates keystore (<ulink
                            url="http://java.sun.com/j2se/1.5.0/docs/guide/security/jsse/JSSERefGuide.html#CustomizingStores"
                            >more info</ulink>).</para>
                </note>

                <note>
                    <para>Warning: when saving a document to the WebDAV server via Oxygen, remember to double check if
                        the document path in the File URL field at the top of the dialog does really contain the URL to
                        which you want to save the document. It happens very easily that you click on another folder or
                        resource by mistake and thus overwrite the wrong resource. </para>
                </note>


            </section>

            <section>
                <title>XMLspy</title>

                <para>
                    <itemizedlist>
                        <listitem>
                            <para>Select <command>File -&gt; Open URL</command></para>
                        </listitem>
                        <listitem>
                            <para>Enter <command>Username, Password</command>
                            </para>
                        </listitem>
                        <listitem>
                            <para>Enter <command>Server URL</command> without a slash on the end (otherwise you'll see
                                2x 'db')</para>
                        </listitem>
                    </itemizedlist>
                    <screenshot>
                        <graphic fileref="resources/webdav_xmlspy.png"/>
                    </screenshot>
                </para>

            </section>

            <section>
                <title>KDE Konqueror</title>

                <para>Enter an URL like <command>webdav://localhost:8080/exist/webdav/db</command>. Use
                        <command>webdavs://</command> for webDAV over SSL. <screenshot>
                        <graphic fileref="resources/webdav_konqueror.png"/>
                    </screenshot>
                </para>

            </section>
        </section>

        <section id="revert">
            <title>Revert to old implementation</title>
            <para>Before eXist-db release 1.4.1 a custom implementation was used. This implementation has been
                deprecated because it was not stable enough and many WebDAV (enabled) clients could not connect to the
                server. Although explicitly not recommended, it is possible to switch back to the old implementation by
                modifying the webdav configuration entry in the file <command>WEB-INF/controller-config.xml</command>.
                Modify the line
                <synopsis format="linespecific">&lt;forward pattern="/webdav/" servlet="milton"/></synopsis> into
                <synopsis format="linespecific">&lt;forward pattern="/webdav/" servlet="WebDAVServlet"/></synopsis>.
            </para>
        </section>

    </chapter>
</book>
