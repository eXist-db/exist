<project xmlns:xdb="http://exist-db.org/ant" default="load-mods" name="MODS Database Loader">
<!--
This file is intended to update only the org folder inside the exist database after a revision change.

-->

	<property file="local.properties"/>

	<property name="user.default.name" value="editor"/>
	<property name="user.default.password" value="editor"/>
	<property name="user.default.group" value="biblio.users"/>
	
	<property name="server.dir" value="../.."/>
	<property name="mods.dir" value="${server.dir}/webapp/biblio/mods/"/>
	<property name="samples.dir" value="${server.dir}/samples"/>
	<property name="scripts.dir" value="../scripts"/>
	<property name="styles.dir" value="../styles"/>
	
	<path id="classpath.core">
		<fileset dir="${server.dir}/lib/core">
			<include name="*.jar"/>
		</fileset>
		<pathelement path="${server.dir}/exist.jar"/>
		<pathelement path="${server.dir}/exist-optional.jar"/>
	</path>

	<typedef resource="org/exist/ant/antlib.xml" uri="http://exist-db.org/ant">
		<classpath refid="classpath.core"/>
	</typedef>

	<target name="load-mods" xmlns:xdb="http://exist-db.org/ant">
		<echo message="Removing old MODS application from eXist database"/>
		<xdb:remove user="${public.xmldb.username}" password="${public.xmldb.password}"
			uri="${server-uri}" collection="${mods-collection}" failonerror="false"/>

		<echo message="Uploading application files"/>
		<xdb:store user="${public.xmldb.username}" password="${public.xmldb.password}"
			uri="${server-uri}/${mods-collection}" createcollection="true"
			createsubcollections="true" failonerror="false">
			<fileset dir="${mods.dir}" id="id">
				<include name="**/*.xq"/>
				<include name="**/*.xql"/>
				<include name="**/*.xml"/>
				<include name="**/*.xsl"/>
				<include name="**/*.xqm"/>
				<include name="**/*.css"/>
				<include name="**/*.js"/>
				<include name="**/*.png"/>
				<include name="**/*.gif"/>
				<include name="**/*.jpg"/>
				<include name="**/*.properties"/>
				<exclude name="**/.svn"/>
			</fileset>
		</xdb:store>
		
		<echo message="Storing jQuery scripts"/>
		<xdb:store user="${public.xmldb.username}" password="${public.xmldb.password}"
			uri="${server-uri}/${mods-collection}/scripts" createcollection="true" createsubcollections="true"
			failonerror="false">
			<fileset dir="${scripts.dir}">
				<include name="jquery/**"/>
				<exclude name="**/.svn"/>
			</fileset>
		</xdb:store>
		
		<echo message="Storing global CSS styles"/>
		<xdb:store user="${public.xmldb.username}" password="${public.xmldb.password}"
			uri="${server-uri}/${mods-collection}/styles" createcollection="true" createsubcollections="true"
			failonerror="false">
			<fileset dir="${styles.dir}">
				<include name="default-style2.css"/>
			</fileset>
		</xdb:store>
                <echo message="Creating temp collection ${server-uri}/${app-collection}/${temp-collection-name}"/>
		<xdb:create user="${public.xmldb.username}" password="${public.xmldb.password}" uri="${server-uri}/${app-collection}" collection="${temp-collection-name}" failonerror="false"/>
		<xdb:chown user="${public.xmldb.username}" password="${public.xmldb.password}" uri="${server-uri}/${app-collection}/${temp-collection-name}" name="${user.default.name}" group="${user.default.group}" failonerror="true"/>
		<xdb:chmod user="${public.xmldb.username}" password="${public.xmldb.password}" uri="${server-uri}/${app-collection}/${temp-collection-name}" mode="rwurwu---" failonerror="true"/>
		
		
	</target>

</project>
