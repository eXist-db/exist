var eXide=eXide||{};eXide.namespace=function(d){d=d.split(".");var e=eXide,f;if(d[0]=="eXide")d=d.slice(1);for(f=0;f<d.length;f++){if(typeof e[d[f]]=="undefined")e[d[f]]={};e=e[d[f]]}return e};eXide.namespace("eXide.util");
eXide.util=function(){var d={dir1:"up",dir2:"left",firstpos1:15,firstpos2:15};return{popup:function(e,f,h,i){function a(l){if(b){b.empty();l.find(".tooltip").each(function(){b.html($(this).html())})}}var c=$(e),b=f?$(f):null;h.sort(function(l,n){return l.label==n.label?0:l.label>n.label?1:-1});c.css("display","block").focus();e=document.createElement("ul");for(f=0;f<h.length;f++){var g=document.createElement("li");g.appendChild(document.createTextNode(h[f].label));if(h[f].tooltip){var j=document.createElement("span");
j.className="tooltip";j.appendChild(document.createTextNode(h[f].tooltip));g.appendChild(j)}e.appendChild(g)}c.html(e);b&&b.css("display","block");var k=c.find("ul li:first").addClass("selection");a(k);var m=c.height();c.keydown(function(l){if(l.which==40){l=k.next();if(l.length>0){k.removeClass("selection");l.addClass("selection");k=l;l.position().top>m&&l.get(0).scrollIntoView();a(l)}}else if(l.which==38){l=k.prev();if(l.length>0){k.removeClass("selection");l.addClass("selection");k=l;l.position().top<
0&&l.get(0).scrollIntoView();a(l)}}else if(l.which==13){var n=c.find("li").index(k);c.css("display","none");b&&b.css("display","none");c.unbind(l);i.call(null,h[n])}else{c.css("display","none");b&&b.css("display","none");c.unbind(l);i.call(null,null);return true}return false})},supportsHtml5Storage:function(){try{return"localStorage"in window&&window.localStorage!==null}catch(e){return false}},normalizePath:function(e){e=e.replace(/^xmldb:exist:\/\//,"");var f=[];e=e.split("/");for(var h=e.length-
1;h>-1;h--)if(e[h]=="..")h--;else f.push(e[h]);return f.reverse().join("/")},parseSignature:function(e){var f=e.indexOf("(");if(f>-1){var h=e.substring(0,f+1);e=e.substring(f);if(e=e.match(/\$[\w:-_]+/g))for(f=0;f<e.length;f++){if(f>0)h+=", ";h+=e[f]}h+=")";return h}return e},message:function(e){$.pnotify({pnotify_text:e,pnotify_shadow:true,pnotify_hide:true,pnotify_closer:true,pnotify_opacity:0.75,pnotify_addclass:"stack-bottomright",pnotify_stack:d})},error:function(e,f){var h={pnotify_text:e,pnotify_type:"error",
pnotify_shadow:true,pnotify_hide:true,pnotify_addclass:"stack-bottomright",pnotify_stack:d};if(f)h.pnotify_title=f;$.pnotify(h)}}}();eXide.namespace("eXide.util.Dialog");
eXide.util.Dialog=function(){var d;$(document).ready(function(){$(document.body).append('<div id="eXide-dialog-message">\t<img id="eXide-dialog-message-icon" src="images/error.png"/>\t<div id="eXide-dialog-message-body"></div></div>');d=$("#eXide-dialog-message");d.dialog({modal:true,autoOpen:false,buttons:{OK:function(){$(this).dialog("close")}}})});return{message:function(e,f){d.dialog("option","title",e);$("#eXide-dialog-message-body").html(f);$("#eXide-dialog-message-icon").attr("src","images/information.png");
d.dialog("open")},warning:function(e,f){d.dialog("option","title",e);$("#eXide-dialog-message-body").html(f);$("#eXide-dialog-message-icon").attr("src","images/error.png");d.dialog("open")}}}();eXide.namespace("eXide.util.mimeTypes");
eXide.util.mimeTypes=function(){var d={xml:["text/xml","application/xml","application/xhtml+xml"],xquery:["application/xquery"],css:["text/css"],html:["text/html"],javascript:["application/x-javascript"]};return{getMime:function(e){var f=e.indexOf(";");if(f>-1)e=e.substring(0,f);return e},getLangFromMime:function(e){for(var f in d)for(var h=d[f],i=0;i<h.length;i++)if(e==h[i])return f;return"xquery"},getMimeFromLang:function(e){return(e=d[e])?e[0]:"application/xquery"}}}();
(function(d){d.log=function(){window.console&&window.console.log&&console.log.apply(window.console,arguments)};d.fn.log=function(){d.log(this);return this}})(jQuery);eXide.namespace("eXide.edit.commands");
eXide.edit.commands=function(){var d=require("pilot/canon");return{init:function(e){d.addCommand({name:"saveDocument",exec:function(){eXide.app.saveDocument()}});d.addCommand({name:"runQuery",exec:function(){eXide.app.runQuery()}});d.addCommand({name:"openDocument",exec:function(){eXide.app.openDocument()}});d.addCommand({name:"newDocument",exec:function(){eXide.app.newDocument()}});d.addCommand({name:"closeDocument",exec:function(){eXide.app.closeDocument()}});d.addCommand({name:"autocomplete",exec:function(){e.autocomplete()}});
d.addCommand({name:"nextTab",exec:function(){e.nextTab()}});d.addCommand({name:"previousTab",exec:function(){e.previousTab()}});d.addCommand({name:"functionDoc",exec:function(){e.showFunctionDoc()}});d.addCommand({name:"gotoDefinition",exec:function(){e.gotoDefinition()}});d.addCommand({name:"indentOrParam",exec:function(f){var h=e.getActiveDocument();h.template&&h.template.nextParam()||f.editor.indent()}});d.addCommand({name:"escape",exec:function(f){e.getActiveDocument().template=null;f.editor.clearSelection()}})}}}();eXide.namespace("eXide.edit.Outline");
eXide.edit.Outline=function(){Constr=function(d){d.addEventListener("activate",this,this.updateOutline);d.addEventListener("validate",this,this.updateOutline);d.addEventListener("close",this,this.clearOutline);this.funcRe=/declare\s+function\s+(([^\(]+)\([^\)]*\))/;this.funcDefRe=/declare\s+function\s+[^\(]+\([^\)]*\)/g;this.varDefRe=/declare\s+variable\s+\$[^\s;]+/gm;this.varRe=/declare\s+variable\s+(\$[^\s;]+)/;this.parseImportRe=/import\s+module\s+namespace\s+[^=]+\s*=\s*["'][^"']+["']\s*at\s+["'][^"']+["']\s*;/g;this.moduleRe=
/import\s+module\s+namespace\s+([^=\s]+)\s*=\s*["']([^"']+)["']\s*at\s+["']([^"']+)["']\s*;/;this.currentDoc=null;this.templates=[];this.$loadTemplates()};Constr.prototype={getTemplates:function(d){d=RegExp("^"+d);for(var e=[],f=0;f<this.templates.length;f++)this.templates[f].name.match(d)&&e.push(this.templates[f]);return e},gotoDefinition:function(d,e){$.each(d.functions,function(f,h){if(e==h.name)switch(h.type){case "function":eXide.app.findFunction(h.source==""?null:h.source,e);break;case "variable":eXide.app.findVarDecl(h.source==
""?null:h.source,e)}})},updateOutline:function(d){this.currentDoc=d;d.functions=[];$("#outline").empty();if(d.getMime()=="application/xquery"){var e=d.getText();this.$parseLocalFunctions(e,d);this.$outlineUpdate(d);(e=this.$parseImports(e))&&this.$resolveImports(d,e)}},clearOutline:function(){$("#outline").empty()},$parseLocalFunctions:function(d,e){e.functions=[];var f=d.match(this.funcDefRe);if(f)for(var h=0;h<f.length;h++){var i=this.funcRe.exec(f[h]);e.functions.push({type:"function",name:i[2],
signature:i[1]})}if(f=d.match(this.varDefRe))for(h=0;h<f.length;h++){i=this.varRe.exec(f[h]);e.functions.push({type:"variable",name:i[1]})}},$parseImports:function(d){return d.match(this.parseImportRe)},$resolveImports:function(d,e){for(var f=this,h=[],i=[],a=0;a<e.length;a++){var c=this.moduleRe.exec(e[a]);if(c!=null&&c.length==4){i.push("prefix="+encodeURIComponent(c[1]));i.push("uri="+encodeURIComponent(c[2]));i.push("source="+encodeURIComponent(c[3]))}}a="xmldb:exist://"+d.getBasePath();i.push("base="+
encodeURIComponent(a));$.ajax({url:"outline",dataType:"json",type:"POST",data:i.join("&"),success:function(b){if(b!=null){b=b.modules;for(var g=0;g<b.length;g++){var j=b[g].functions;if(j)for(var k=0;k<j.length;k++)h.push({type:"function",name:j[k],signature:j[k],source:b[g].source});if(j=b[g].variables)for(k=0;k<j.length;k++)h.push({type:"variable",name:"$"+j[k],source:b[g].source})}d.functions=d.functions.concat(h);f.$outlineUpdate(d)}}});return h},$sortFunctions:function(d){d.functions.sort(function(e,
f){return e.name==f.name?0:e.name>f.name?1:-1})},$outlineUpdate:function(d){this.$sortFunctions(d);if(this.currentDoc==d){$("body").layout().open("west");eXide.app.resize();var e=$("#outline");e.empty();for(var f=0;f<d.functions.length;f++){var h=d.functions[f],i=document.createElement("li"),a=document.createElement("a");if(h.signature)a.title=h.signature;a.className=h.type=="function"?"t_function":"t_variable";a.href=h.source?"#"+h.source:"#";a.appendChild(document.createTextNode(h.name));i.appendChild(a);
e.append(i);$(a).click(function(){var c=this.hash.substring(1);this.className=="t_function"?eXide.app.findFunction(c==""?null:c,$(this).text()):eXide.app.findVarDecl(c==""?null:c,$(this).text());return false})}}},$loadTemplates:function(){var d=this;$.ajax({url:"templates/snippets.xml",dataType:"xml",type:"GET",success:function(e){$(e).find("snippet").each(function(){var f=$(this),h=f.attr("abbrev"),i=f.find("description").text();f=f.find("code").text();d.templates.push({TYPE:"template",name:h,help:i,
template:f})})}})}};return Constr}();eXide.namespace("eXide.keyboard");
eXide.keyboard=function(){var d=require("ace/keyboard/hash_handler").HashHandler,e={selectall:"Ctrl-A",removeline:"Ctrl-D",gotoline:"Ctrl-L",togglecomment:"Ctrl-7",findnext:"Ctrl-K",findprevious:"Ctrl-Shift-K",find:"Ctrl-F",replace:"Ctrl-R",undo:"Ctrl-Z",redo:"Ctrl-Shift-Z|Ctrl-Y",overwrite:"Insert",copylinesup:"Ctrl-Alt-Up",movelinesup:"Alt-Up",selecttostart:"Alt-Shift-Up",gotostart:"Ctrl-Home|Ctrl-Up",selectup:"Shift-Up",golineup:"Up",copylinesdown:"Ctrl-Alt-Down",movelinesdown:"Alt-Down",selecttoend:"Alt-Shift-Down",
gotoend:"Ctrl-End|Ctrl-Down",selectdown:"Shift-Down",golinedown:"Down",selectwordleft:"Ctrl-Shift-Left",gotowordleft:"Ctrl-Left",selecttolinestart:"Alt-Shift-Left",gotolinestart:"Alt-Left|Home",selectleft:"Shift-Left",gotoleft:"Left",selectwordright:"Ctrl-Shift-Right",gotowordright:"Ctrl-Right",selecttolineend:"Alt-Shift-Right",gotolineend:"Alt-Right|End",selectright:"Shift-Right",gotoright:"Right",selectpagedown:"Shift-PageDown",gotopagedown:"PageDown",selectpageup:"Shift-PageUp",gotopageup:"PageUp",
selectlinestart:"Shift-Home",selectlineend:"Shift-End",del:"Delete",backspace:"Backspace",outdent:"Shift-Tab",indentOrParam:"Tab",saveDocument:"Ctrl-Shift-S",openDocument:"Ctrl-Shift-O",newDocument:"Ctrl-Shift-N",closeDocument:"Ctrl-Shift-W",runQuery:"Ctrl-Return",autocomplete:"Ctrl-Space",escape:"Esc",functionDoc:"Ctrl-Shift-H|F1",nextTab:"Ctrl-Shift-PageDown",previousTab:"Ctrl-Shift-PageUp",gotoDefinition:"Ctrl-Shift-B|F3"};return{getKeybinding:function(){return new d(e)},help:function(f){$(f).find("table").each(function(){this.innerHTML=
"";for(var h in e)if(h!="reverse"){var i=document.createElement("tr"),a=document.createElement("td");a.appendChild(document.createTextNode(h));i.appendChild(a);a=document.createElement("td");a.appendChild(document.createTextNode(e[h]));i.appendChild(a);this.appendChild(i)}})}}}();define("ace/mode/xquery_highlight_rules",function(d,e){var f=d("pilot/oop"),h=d("pilot/lang"),i=d("ace/mode/text_highlight_rules").TextHighlightRules,a=function(){var c=h.arrayToMap("return|for|let|declare|function|xquery|version|option|namespace|import|module|if|then|else|as|and|or|typeswitch|case".split("|"));this.$rules={start:[{token:"text",regex:"<\\!\\[CDATA\\[",next:"cdata"},{token:"xml_pe",regex:"<\\?.*?\\?>"},{token:"comment",regex:"<\\!--",next:"comment"},{token:"comment",regex:"\\(:",next:"comment"},
{token:"text",regex:"<\\/?",next:"tag"},{token:"constant",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"variable",regex:"\\$[a-zA-Z_][a-zA-Z0-9_\\-:]*\\b"},{token:"string",regex:'".*?"'},{token:"string",regex:"'.*?'"},{token:"text",regex:"\\s+"},{token:function(b){return c[b]?"keyword":"identifier"},regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"}],tag:[{token:"text",regex:">",next:"start"},{token:"keyword",regex:"[-_a-zA-Z0-9:]+"},{token:"text",regex:"\\s+"},{token:"string",regex:'".*?"'},
{token:"string",regex:"'.*?'"}],cdata:[{token:"text",regex:"\\]\\]>",next:"start"},{token:"text",regex:"\\s+"},{token:"text",regex:"(?:[^\\]]|\\](?!\\]>))+"}],comment:[{token:"comment",regex:".*?--\>",next:"start"},{token:"comment",regex:".*:\\)",next:"start"},{token:"comment",regex:".+"}]}};f.inherits(a,i);e.XQueryHighlightRules=a});
define("ace/mode/xquery",function(d,e){var f=d("pilot/oop"),h=d("ace/mode/text").Mode,i=d("ace/tokenizer").Tokenizer,a=d("ace/mode/xquery_highlight_rules").XQueryHighlightRules,c=function(){this.$tokenizer=new i((new a).getRules())};f.inherits(c,h);(function(){this.getNextLineIndent=function(b,g,j){b=this.$getIndent(g);if(g.match(/\s*(?:then|else|return)\s*$/))b+=j;return b}}).call(c.prototype);e.Mode=c});eXide.namespace("eXide.edit.Document");
eXide.edit.Document=function(){Constr=function(d,e,f){this.name=d;this.path=e;this.mime="application/xquery";this.syntax="xquery";this.saved=false;this.editable=true;this.functions=[];this.$session=f};Constr.prototype={getText:function(){return this.$session.getValue()},getName:function(){return this.name},getPath:function(){return this.path},getBasePath:function(){return this.path.replace(/(^.+)\/[^\/]*$/,"$1")},getMime:function(){return this.mime},getSyntax:function(){return this.syntax},isSaved:function(){return this.saved},
isEditable:function(){return this.editable},isXQuery:function(){return this.mime=="application/xquery"}};return Constr}();eXide.namespace("eXide.edit.Editor");
eXide.edit.Editor=function(){var d=require("ace/virtual_renderer").VirtualRenderer,e=require("ace/editor").Editor,f=require("ace/edit_session").EditSession,h=require("ace/undomanager").UndoManager,i=/^[\$\w:\-_\.]+/;Constr=function(a){var c=this;c.container=a;c.documents=[];c.activeDoc=null;c.tabCounter=0;c.newDocCounter=0;c.pendingCheck=false;c.events={activate:[],validate:[],close:[]};eXide.edit.commands.init(c);require("pilot/plugin_manager").catalog.registerPlugins(["pilot/index"]);a=new d(c.container,
"ace/theme/eclipse");a.setShowGutter(true);this.editor=new e(a);this.editor.setKeyboardHandler(eXide.keyboard.getKeybinding());this.outline=new eXide.edit.Outline(this);this.status=document.getElementById("error-status");$(this.status).click(function(b){b.preventDefault();var g=this.pathname;b=this.hash.substring(1);if(g=c.getDocument(g)){c.switchTo(g);c.editor.gotoLine(parseInt(b)+1)}});this.lastChangeEvent=(new Date).getTime();this.validateTimeout=null};Constr.prototype={init:function(){this.documents.length==
0&&this.newDocument()},getActiveDocument:function(){return this.activeDoc},getText:function(){return this.activeDoc.getText()},newDocument:function(){for(var a=this,c=0,b=0;b<a.documents.length;b++)if(a.documents[b].path.match(/^__new__(\d+)/))c=parseInt(RegExp.$1);c++;var g=new eXide.edit.Document("new-document "+c,"__new__"+c,new f('xquery version "1.0";\n'));g.$session.setUndoManager(new h);g.$session.addEventListener("change",function(){g.saved=false;a.triggerCheck()});c=require("ace/mode/xquery").Mode;
g.$session.setMode(new c);this.addTab(g);this.editor.setSession(g.$session);this.editor.focus()},newDocumentWithText:function(a,c,b){a=new eXide.edit.Document(b.name,b.path,new f(a));a.editable=b.writable;a.mime=c;a.syntax=eXide.util.mimeTypes.getLangFromMime(c);a.saved=false;this.$initDocument(a)},openDocument:function(a,c,b){b.writable?eXide.util.message("Opening "+b.path):eXide.util.message("Opening "+b.path+" readonly!");a=new eXide.edit.Document(b.name,b.path,new f(a));a.editable=b.writable;
a.mime=c;a.syntax=eXide.util.mimeTypes.getLangFromMime(c);a.saved=true;$.log("opening %s, mime: %s, syntax: %s",b.name,a.mime,a.syntax);this.$initDocument(a)},$initDocument:function(a){var c=this;c.$setMode(a);a.$session.setUndoManager(new h);a.$session.addEventListener("change",function(){if(a.saved){a.saved=false;c.updateTabStatus(a.path,a)}c.triggerCheck()});c.addTab(a);c.editor.setSession(a.$session);c.editor.resize();c.editor.focus()},setMode:function(a){this.activeDoc.syntax=a;this.$setMode(this.activeDoc,
true)},$setMode:function(a,c){switch(a.syntax){case "xquery":var b=require("ace/mode/xquery").Mode;a.$session.setMode(new b);if(c)a.mime="application/xquery";break;case "xml":b=require("ace/mode/xml").Mode;a.$session.setMode(new b);if(c)a.mime="application/xml";break;case "html":b=require("ace/mode/html").Mode;a.$session.setMode(new b);if(c)a.mime="text/html";break;case "javascript":b=require("ace/mode/javascript").Mode;a.$session.setMode(new b);if(c)a.mime="application/x-javascript";break;case "css":b=
require("ace/mode/css").Mode;a.$session.setMode(new b);if(c)a.mime="text/css"}},closeDocument:function(){this.$triggerEvent("close",[this.activeDoc]);$("#tabs a[title="+this.activeDoc.path+"]").parent().remove();for(var a=0;a<this.documents.length;a++)this.documents[a].path==this.activeDoc.path&&this.documents.splice(a,1);if(this.documents.length==0)this.newDocument();else{this.activeDoc=this.documents[this.documents.length-1];$("#tabs a[title="+this.activeDoc.path+"]").addClass("active");this.editor.setSession(this.activeDoc.$session);
this.editor.resize();this.$triggerEvent("activate",[this.activeDoc])}},saveDocument:function(a,c,b){var g=this,j=g.activeDoc.path,k=g.activeDoc.name;if(a){g.activeDoc.path=a.path;g.activeDoc.name=a.name}eXide.util.message("Storing resource "+g.activeDoc.name+"...");a={path:g.activeDoc.path,data:g.activeDoc.getText()};if(g.activeDoc.mime)a.mime=g.activeDoc.mime;$.ajax({url:"store.xql",type:"POST",data:a,dataType:"json",success:function(m){if(m)b?b.apply(g.activeDoc,[m.message]):eXide.util.error(m.message);
else{g.activeDoc.saved=true;g.updateTabStatus(j,g.activeDoc);c?c.apply(g.activeDoc):eXide.util.message(g.activeDoc.name+" stored.")}},error:function(m){g.activeDoc.path=j;g.activeDoc.name=k;b?b.apply(g.activeDoc,m.responseText):eXide.util.error(m.responseText)}})},getDocument:function(a){a=eXide.util.normalizePath(a);for(var c=0;c<this.documents.length;c++)if(this.documents[c].path==a)return this.documents[c]},autocomplete:function(){if(this.activeDoc.isXQuery()){require("pilot/lang");var a=require("ace/range").Range,
c=this.editor.getSelection(),b=this.editor.getSession();c=c.getSelectionLead();var g=b.getDisplayLine(c.row);b=c.column-1;for(var j=c.column;b>=0;){var k=g.substring(b,j);if(k.match(/^\$[\w:\-_\.]+$/))break;if(!k.match(/^[\w:\-_\.]+$/)){b++;break}b--}g=g.substring(b,j);$.log("completing token: %s",g);a=new a(c.row,b,c.row,j);c=this.editor.renderer.textToScreenCoordinates(c.row,c.column);$("#autocomplete-box").css({left:c.pageX+"px",top:c.pageY+20+"px"});$("#autocomplete-help").css({left:c.pageX+324+
"px",top:c.pageY+20+"px"});g.length==0?this.templateLookup(this.activeDoc,g,a,true):this.functionLookup(this.activeDoc,g,a,true);return true}},$localVars:function(a,c){for(var b=[],g=/declare function|};/,j=/let \$[\w\:]+|for \$[\w\:]+|\$[\w\:]+\)/,k=/\$[\w\:]+/,m=RegExp("^\\"+a),l=this.editor.getSession(),n=c.start.row;n>-1;){var p=l.getDisplayLine(n),o;if(o=p.match(j)){$.log("Var: %s",o[0]);o=o[0].match(k);o[0].match(m)&&b.push({name:o[0],type:"variable"})}if(p.match(g)){$.log("Stop: %s",p);break}n--}return b},
functionLookup:function(a,c,b,g){var j=this;$.ajax({url:"docs.xql",dataType:"text",type:"POST",data:{prefix:c},success:function(k){k=$.parseJSON(k);var m=[],l;if(c.substring(0,1)=="$"){l="^\\"+c;m=j.$localVars(c,b,g)}else l="^"+c;var n=RegExp(l);$.each(j.activeDoc.functions,function(o,q){q.name.match(n)&&m.push(q)});if(k)m=m.concat(k);k=[];for(l=0;l<m.length;l++){var p={label:m[l].signature?m[l].signature:m[l].name,type:m[l].type};if(m[l].help)p.tooltip=m[l].help;k.push(p)}j.$addTemplates(c,k);j.$showPopup(a,
b,k)},error:function(k,m){eXide.util.error(m)}})},templateLookup:function(a,c,b){var g=[];this.$addTemplates(c,g);this.$showPopup(a,b,g)},$addTemplates:function(a,c){for(var b=this.outline.getTemplates(a),g=0;g<b.length;g++)c.push({type:"template",label:"[S] "+b[g].name,tooltip:b[g].help,template:b[g].template})},$showPopup:function(a,c,b){var g=this;eXide.util.popup($("#autocomplete-box"),$("#autocomplete-help"),b,function(j){if(j){var k=j.label;if(j.type=="template")k=j.template;else if(j.type==
"function")k=eXide.util.parseSignature(k);a.template=new eXide.edit.Template(g,c,k,j.type);a.template.insert()}g.editor.focus()})},getFunctionAtCursor:function(a){var c=a.row;c=this.editor.getSession().getDisplayLine(c);var b=a.column;do b--;while(b>=0&&c.charAt(b).match(i));b++;for(a=a.column;a<c.length&&c.charAt(a).match(i);)a++;return c.substring(b,a)},showFunctionDoc:function(){var a=this.editor.getSelection().getSelectionLead(),c=this.editor.renderer.textToScreenCoordinates(a.row,a.column);$("#autocomplete-box").css({left:c.pageX+
"px",top:c.pageY+20+"px"});$("#autocomplete-help").css({left:c.pageX+324+"px",top:c.pageY+20+"px"});this.functionLookup(this.activeDoc,this.getFunctionAtCursor(a),null,false)},gotoDefinition:function(){var a=this.getFunctionAtCursor(this.editor.getSelection().getSelectionLead());$.log("funcName = %s",a);a&&this.outline.gotoDefinition(this.activeDoc,a)},gotoFunction:function(a){var c=this.getModuleNamespacePrefix();if(c!=null)a=a.replace(/[^:]+:/,c+":");$.log("Goto function %s",a);a=RegExp("function\\s+"+
a+"\\s*\\(");c=this.activeDoc.$session.getLength();for(var b=0;b<c;b++)if(this.activeDoc.$session.getLine(b).match(a)){this.editor.gotoLine(b+1);this.editor.focus();break}},gotoVarDecl:function(a){var c=this.getModuleNamespacePrefix();if(c!=null)a=a.replace(/[^:]+:/,"$"+c+":");$.log("Goto variable declaration %s",a);a=RegExp("variable\\s+\\"+a);c=this.activeDoc.$session.getLength();for(var b=0;b<c;b++)if(this.activeDoc.$session.getLine(b).match(a)){this.editor.gotoLine(b+1);this.editor.focus();break}},
getModuleNamespacePrefix:function(){for(var a=/^\s*module\s+namespace\s+([^=\s]+)\s*=/,c=this.activeDoc.$session.getLength(),b=0;b<c;b++){var g=this.activeDoc.$session.getLine(b).match(a);if(g)return g[1]}return null},resize:function(){this.editor.resize()},addTab:function(a){var c=this,b="t"+c.tabCounter++,g=a.name;a.saved||(g+="*");$("#tabs li a").removeClass("active");var j=document.createElement("li"),k=document.createElement("a");k.appendChild(document.createTextNode(g));k.className="tab active";
k.id=b;k.title=a.path;j.appendChild(k);$("#tabs").append(j);$(k).click(function(m){m.preventDefault();c.switchTo(a)});c.activeDoc=a;c.documents.push(a);c.$triggerEvent("activate",[a])},nextTab:function(){if(!(this.documents.length<2)){for(var a=0,c=0;c<this.documents.length;c++)if(this.documents[c]==this.activeDoc){a=c;break}if(a==this.documents.length-1)a=0;else a++;this.switchTo(this.documents[a])}},previousTab:function(){if(!(this.documents.length<2)){for(var a=0,c=0;c<this.documents.length;c++)if(this.documents[c]==
this.activeDoc){a=c;break}if(a==0)a=this.documents.length-1;else a--;this.switchTo(this.documents[a])}},switchTo:function(a){this.editor.setSession(a.$session);this.editor.resize();this.activeDoc=a;$("#tabs a").each(function(){this.title==a.path?$(this).addClass("active"):$(this).removeClass("active")});this.status.innerHTML="";this.$triggerEvent("activate",[a])},updateTabStatus:function(a,c){var b;b=c.saved?c.name:c.name+"*";$("#tabs a[title="+a+"]").attr("title",c.path).text(b)},setTheme:function(a){$.log("Changing theme to %s",
a);this.editor.setTheme(a)},triggerCheck:function(){if(this.activeDoc.isXQuery()){var a=this;if(!a.pendingCheck){var c=(new Date).getTime();a.validateTimeout&&c-a.lastChangeEvent<2E3&&clearTimeout(a.validateTimeout);a.lastChangeEvent=c;a.validateTimeout=setTimeout(function(){a.validateQuery.apply(a)},2E3)}}},validateQuery:function(){if(this.activeDoc.isXQuery){this.pendingCheck=true;$.log("Running validation...");var a=this,c=a.getText(),b="xmldb:exist://"+a.activeDoc.getBasePath();$.ajax({type:"POST",
url:"compile.xql",data:{q:c,base:b},dataType:"json",success:function(g){a.compileError(g);a.pendingCheck=false},error:function(g,j){a.pendingCheck=false;$.log("Compile error: %s - %s",j,g.responseText)}});a.$triggerEvent("validate",[a.activeDoc])}},evalError:function(a){var c=/.*line\s(\d+)/i.exec(a),b=-1;if(c)b=parseInt(c[1]);$.log("error in line %d",c[1]);this.editor.focus();this.editor.gotoLine(b);c=[{row:b-1,text:a,type:"error"}];this.status.innerHTML=a;this.editor.getSession().setAnnotations(c)},
compileError:function(a){if(a.result=="fail"){var c;c=a.error.line?a.error["#text"]:a.error;var b=/.*line:?\s(\d+)/i.exec(c),g=-1;if(b)g=parseInt(b[1])-1;else if(a.error.line)g=parseInt(a.error.line)-1;a=[{row:g,text:c,type:"error"}];this.status.innerHTML=c;this.status.href=this.activeDoc.path+"#"+g;this.editor.getSession().setAnnotations(a)}else{this.clearErrors();this.status.innerHTML=""}},clearErrors:function(){this.editor.getSession().clearAnnotations()},saveState:function(){var a=0;$.each(this.documents,
function(c,b){if(b.path.match("^__new__.*")){localStorage["eXide."+a+".path"]=b.path;localStorage["eXide."+a+".name"]=b.name;localStorage["eXide."+a+".mime"]=b.mime;localStorage["eXide."+a+".data"]=b.getText()}else{localStorage["eXide."+a+".path"]=b.path;localStorage["eXide."+a+".name"]=b.name;localStorage["eXide."+a+".mime"]=b.mime;localStorage["eXide."+a+".writable"]=b.editable?"true":"false";b.saved||(localStorage["eXide."+a+".data"]=b.getText())}a++});localStorage["eXide.documents"]=a},addEventListener:function(a,
c,b){(a=this.events[a])&&a.push({obj:c,callback:b})},$triggerEvent:function(a,c){var b=this.events[a];if(b)for(var g=0;g<b.length;g++)b[g].callback.apply(b[g].obj,c)}};return Constr}();$(document).ready(function(){eXide.app.init()});eXide.namespace("eXide.app");
eXide.app=function(){var d,e,f,h=0,i=0,a=0,c=0;return{init:function(){d=new eXide.edit.Editor(document.getElementById("editor"));e=new eXide.edit.PackageEditor(document.getElementById("deployment-editor"));f=new eXide.browse.Browser(document.getElementById("open-dialog"));eXide.app.initGUI();eXide.app.restoreState();d.init();d.addEventListener("outlineChange",eXide.app.onOutlineChange);eXide.app.resize();$(window).resize(eXide.app.resize);$(window).unload(function(){eXide.app.saveState()})},resize:function(){$("#editor");
$(".header");d.resize()},newDocument:function(){d.newDocument()},findDocument:function(b){var g=d.getDocument(b);if(g==null){b={name:b.match(/[^\/]+$/),path:b};eXide.app.$doOpenDocument(b)}else d.switchTo(g)},findFunction:function(b,g){if(b==null)d.gotoFunction(g);else{$.log("Locating function %s in document %s",g,b);var j=d.getDocument(b);if(j==null){j={name:b.match(/[^\/]+$/),path:b};eXide.app.$doOpenDocument(j,function(){d.gotoFunction(g)})}else{d.switchTo(j);d.gotoFunction(g)}}},findVarDecl:function(b,
g){if(b==null)d.gotoVarDecl(g);else{$.log("Locating variable %s in document %s",g,b);var j=d.getDocument(b);if(j==null){j={name:b.match(/[^\/]+$/),path:b};eXide.app.$doOpenDocument(j,function(){d.gotoVarDecl(g)})}else{d.switchTo(j);d.gotoVarDecl(g)}}},openDocument:function(){f.reload();$("#open-dialog").dialog("option","buttons",{cancel:function(){$(this).dialog("close")},open:eXide.app.openSelectedDocument});$("#open-dialog").dialog("open")},openSelectedDocument:function(){var b=f.getSelection();
eXide.app.$doOpenDocument(b);$(this).dialog("close")},$doOpenDocument:function(b,g){b.path=eXide.util.normalizePath(b.path);$.ajax({url:"load.xql?path="+b.path,dataType:"text",success:function(j,k,m){k=eXide.util.mimeTypes.getMime(m.getResponseHeader("Content-Type"));d.openDocument(j,k,b);g&&g.call(null,b)},error:function(j){eXide.util.error("Failed to load document "+b.path+": "+j.status+" "+j.statusText)}})},closeDocument:function(){d.getActiveDocument().isSaved()?d.closeDocument():$("#dialog-confirm-close").dialog({resizable:false,
height:140,modal:true,buttons:{Close:function(){$(this).dialog("close");d.closeDocument()},Cancel:function(){$(this).dialog("close")}}})},saveDocument:function(){if(d.getActiveDocument().getPath().match("^__new__")){$("#open-dialog").dialog("option","buttons",{Cancel:function(){$(this).dialog("close")},Save:function(){d.saveDocument(f.getSelection(),function(){$("#open-dialog").dialog("close")},function(b){eXide.util.Dialog.warning("Failed to Save Document",b)})}});$("#open-dialog").dialog("open")}else d.saveDocument(null,
function(){eXide.util.message(d.getActiveDocument().getName()+" stored.")},function(b){eXide.util.Dialog.warning("Failed to Save Document",b)})},download:function(){var b=d.getActiveDocument();if(b.getPath().match("^__new__")||!b.isSaved())eXide.util.error("There are unsaved changes in the document. Please save it first.");else window.location.href="load.xql?download=true&path="+encodeURIComponent(b.getPath())},runQuery:function(){var b=d.getText(),g="xmldb:exist://"+d.getActiveDocument().getBasePath();
$("#results-container .results").empty();$.ajax({type:"POST",url:"execute",dataType:"xml",data:{qu:b,base:g},success:function(j){j=j.documentElement;if(j.nodeName=="error"){j=$(j).text();eXide.util.error(j,"Compilation Error");d.evalError(j)}else{d.clearErrors();var k=$("body").layout();k.open("south");k.sizePane("south",300);eXide.app.resize();a=i=1;h=j.getAttribute("hits");c=i+10-1;if(h<c)c=h;eXide.util.message("Found "+h+" in "+j.getAttribute("elapsed"));eXide.app.retrieveNext()}},error:function(j){eXide.util.error(j.responseText,
"Server Error")}})},checkQuery:function(){d.validateQuery()},retrieveNext:function(){$.log("retrieveNext: %d",a);if(a>0&&a<=c){var b="results/"+a;a++;$.ajax({url:b,dataType:"html",success:function(g){$("#results-container .results").append(g);$("#results-container .current").text("Showing results "+i+" to "+(a-1)+" of "+h);$("#results-container .pos:last a").click(function(){eXide.app.findDocument(this.pathname);return false});eXide.app.retrieveNext()}})}},browseNext:function(){if(a>0&&c<h){i=a;c=
a+10-1;if(h<c)c=h;$("#results-container .results").empty();eXide.app.retrieveNext()}return false},browsePrevious:function(){if(a>0&&i>1){i-=10;if(i<1)i=1;a=i;c=a+9;if(h<c)c=h;$("#results-container .results").empty();eXide.app.retrieveNext()}return false},deploymentSettings:function(){var b=/^(.*)\/[^\/]+$/.exec(d.getActiveDocument().getPath());if(b)if(eXide.app.$checkLogin()){$.log("Editing deployment settings for collection: %s",b[1]);e.open(b[1])}},newDeployment:function(){eXide.app.$checkLogin()&&
e.open()},deploy:function(){var b=/^(.*)\/[^\/]+$/.exec(d.getActiveDocument().getPath());if(!b){eXide.util.error("The file open in the editor does not belong to an application package!");return false}eXide.app.$checkLogin();$.log("Deploying application from collection: %s",b[1]);e.deploy(b[1]);return false},synchronize:function(){var b=/^(.*)\/[^\/]+$/.exec(d.getActiveDocument().getPath());b&&e.synchronize(b[1])},openApp:function(){var b=/^(.*)\/[^\/]+$/.exec(d.getActiveDocument().getPath());b&&e.runApp(b[1])},
restoreState:function(){if(!eXide.util.supportsHtml5Storage)return false;var b=localStorage["eXide.theme"];if(b){$("#theme").val(b);d.setTheme(b)}(b=localStorage["eXide.documents"])||(b=0);for(var g=0;g<b;g++){var j={path:localStorage["eXide."+g+".path"],name:localStorage["eXide."+g+".name"],writable:localStorage["eXide."+g+".writable"]=="true"},k=localStorage["eXide."+g+".data"];k?d.newDocumentWithText(k,localStorage["eXide."+g+".mime"],j):eXide.app.$doOpenDocument(j)}e.restoreState();return true},
saveState:function(){if(eXide.util.supportsHtml5Storage){localStorage.clear();localStorage["eXide.theme"]=$("#theme").val();d.saveState();e.saveState()}},$checkLogin:function(){if(eXide.app.login)return true;eXide.util.error("Warning: you are not logged in.");return false},initGUI:function(){$("body").layout({enableCursorHotkey:false,north__size:78,north__resizable:false,south__minSize:200,south__initClosed:true,west__size:200,west__initClosed:true,west__contentSelector:".content",center__minSize:300,
center__onresize:eXide.app.resize,center__contentSelector:".content"});$(".menu ul li").hover(function(){$("ul",this).slideDown(200)},function(){$("ul",this).slideUp(200)});$("#open-dialog").dialog({title:"Open File",modal:true,autoOpen:false,height:400,width:700,open:function(){f.init()}});$("#login-dialog").dialog({title:"Login",modal:true,autoOpen:false,buttons:{Login:function(){$.ajax({url:"login",data:$("#login-form").serialize(),success:function(){eXide.app.login=$("#login-form input[name=user]").val();
$.log("Logged in as %s",eXide.app.login);$("#login-dialog").dialog("close");$("#user").text("Logged in as "+eXide.app.login+". ");$("#login").text("Logout")},error:function(){$("#login-error").text("Login failed. Bad username or password.");$("#login-dialog input:first").focus()}})},Cancel:function(){$(this).dialog("close")}},open:function(){$(this).find("input").val("");$(this).find("input:first").focus();$("#login-error").empty();var g=$(this);g.find("input").keyup(function(j){j.keyCode==13&&g.parent().find(".ui-dialog-buttonpane button:first").trigger("click")})}});
$("#keyboard-help").dialog({title:"Keyboard Shortcuts",modal:false,autoOpen:false,height:400,buttons:{Close:function(){$(this).dialog("close")}},open:function(){eXide.keyboard.help($("#keyboard-help"))}});$("#help-shortcuts").click(function(g){g.preventDefault();$("#keyboard-help").dialog("open")});var b=$("#open").button({icons:{primary:"ui-icon-folder-open"}});b.click(eXide.app.openDocument);$("#menu-file-open").click(eXide.app.openDocument);b=$("#close").button({icons:{primary:"ui-icon-close"}});
b.click(eXide.app.closeDocument);$("#menu-file-close").click(eXide.app.closeDocument);b=$("#new").button({icons:{primary:"ui-icon-document"}});b.click(eXide.app.newDocument);$("#menu-file-new").click(eXide.app.newDocument);b=$("#run").button({icons:{primary:"ui-icon-play"}});b.click(eXide.app.runQuery);b=$("#validate").button({icons:{primary:"ui-icon-check"}});b.click(eXide.app.checkQuery);b=$("#save").button({icons:{primary:"ui-icon-disk"}});b.click(eXide.app.saveDocument);$("#menu-file-save").click(eXide.app.saveDocument);
b=$("#download").button({icons:{primary:"ui-icon-transferthick-e-w"}});b.click(eXide.app.download);$("#menu-file-download").click(eXide.app.download);$("#menu-deploy-new").click(eXide.app.newDeployment);$("#menu-deploy-edit").click(eXide.app.deploymentSettings);$("#menu-deploy-deploy").click(eXide.app.deploy);$("#menu-deploy-sync").click(eXide.app.synchronize);$("#menu-edit-undo").click(function(g){g.preventDefault();d.editor.undo()});$("#menu-edit-redo").click(function(g){g.preventDefault();d.editor.redo()});
$("#menu-deploy-run").click(eXide.app.openApp);$("#theme").change(function(){d.setTheme($(this).val())});$("#syntax").change(function(){d.setMode($(this).val())});d.addEventListener("activate",null,function(g){$("#syntax").val(g.getSyntax())});$("#login").click(function(g){g.preventDefault();$("#login-dialog").dialog("open")});$("#results-container .next").click(eXide.app.browseNext);$("#results-container .previous").click(eXide.app.browsePrevious)}}}();eXide.namespace("eXide.edit.PackageEditor");
eXide.edit.PackageEditor=function(){Constr=function(){var d=this;this.directory=null;this.container=$("#sandbox_dialog_deploy");if(this.container.length==0){var e=document.createElement("div");e.id="sandbox_dialog_deploy";document.body.appendChild(e);this.container=$(e)}this.container.dialog({title:"Deployment Editor",modal:true,autoOpen:false,width:480,height:600});this.syncDialog=$("#synchronize-dialog");this.syncDialog.dialog({title:"Synchronize to Directory",modal:true,autoOpen:false,width:500,
height:400,buttons:{Synchronize:function(){var f=d.syncDialog.find("input[name=dir]").val();if(!f||f.length==0)$("#synchronize-report").text("No output directory specified!");else{$("#synchronize-report").text("Synchronization in progress ...");$("#synchronize-report").load("synchronize.xql",{collection:d.collection,start:d.syncDialog.find("input[name=date]").val(),dir:f});this.directory=f}},Close:function(){$(this).dialog("close")}}});this.directory&&this.syncDialog.find("input[name=dir]").val(this.directory)};
Constr.prototype={open:function(d){var e=this,f=null;if(d)f={collection:d};$.ajax({url:"deployment.xql",type:"POST",data:f,success:function(h){e.container.html(h);e.container.form({done:function(){var i=e.container.find("form").serialize();$.ajax({url:"deployment.xql",type:"POST",data:i,success:function(){e.container.dialog("close")},error:function(a){eXide.util.error(a.responseText)}})},cancel:function(){e.container.dialog("close")}});e.container.find(".author-repeat").repeat("#author-add-trigger",
{deleteTrigger:"#author-remove-trigger"});e.container.dialog("open")},error:function(h){eXide.util.error(h.responseText)}})},deploy:function(d){$.ajax({url:"deployment.xql",type:"POST",dataType:"json",data:{collection:d,deploy:"true"},success:function(e){e=location.protocol+"//"+location.hostname+":"+location.port+"/exist/apps/"+e+"/";eXide.util.Dialog.message("Application Deployed",'<p>The application has been deployed. On a standard installation the following link should open it:</p><center><a href="'+
e+'" target="_new">'+e+"</a></center>")},error:function(e){eXide.util.Dialog.warning("Deployment Error","<p>An error has been reported by the database:</p><p>"+e.responseText+"</p>")}})},synchronize:function(d){var e=this;$.getJSON("deployment.xql",{info:d},function(f){if(f.isAdmin){e.collection=f.root;e.syncDialog.find("input[name=date]").val(f.deployed);e.syncDialog.dialog("open")}else eXide.util.error("You need to be logged in as an admin user with dba role to use this feature.")})},runApp:function(d){$.getJSON("deployment.xql",
{info:d},function(e){if(e.isAdmin){e="/exist/apps/"+e.root.replace(/^\/db\//,"")+"/";eXide.util.Dialog.message("Run Application",'<p>Click on the following link to open your application:</p><center><a href="'+e+'" target="_new">'+e+"</a></center>")}else eXide.util.error("You need to be logged in as an admin user with dba role to use this feature.")})},saveState:function(){localStorage["eXide.synchronize.dir"]=this.directory},restoreState:function(){this.directory=localStorage["eXide.synchronize.dir"]}};
return Constr}();eXide.namespace("eXide.edit.Template");
eXide.edit.Template=function(){var d=/\n/;Constr=function(e,f,h,i){var a=h.split(d).length;this.code=h;this.editor=e.editor;this.range=f;this.type=i;this.startLine=f.start.row;this.endLine=this.startLine+a-1;$.log("startLine = %i, endLine = %i",this.startLine,this.endLine);this.currentLine=this.startLine;this.lineOffset=this.startColumn=f.start.column;this.regex=/\$[\w\-:_]+/g;if(this.startColumn>0)this.regex.lastIndex=this.startColumn};Constr.prototype={insert:function(){this.editor.getSession().remove(this.range);this.editor.insert(this.code);
this.code.substring(0,1)!="$"&&this.editor.navigateLeft();this.type!="variable"&&this.nextParam();this.editor.focus()},nextParam:function(){var e=this.editor.getSession(),f=this.editor.getSelection(),h=f.getSelectionLead();if(h.row<this.startLine||h.row>this.endLine)return false;for(var i=h=false;this.currentLine<=this.endLine;){var a=e.getDisplayLine(this.currentLine);$.log("Checking line %s",a);if(a=this.regex.exec(a)){$.log("Matched %s",a[0]);f.setSelectionAnchor(this.currentLine,a.index);f.selectTo(this.currentLine,
a.index+a[0].length);this.lineOffset=a.index;i=true;break}else{this.lineOffset=0;this.currentLine++}if(this.currentLine>this.endLine&&!h){$.log("loop %i",this.startColumn);this.currentLine=this.startLine;if(this.startColumn>0){this.lineOffset=this.startColumn;this.regex.lastIndex=this.lineOffset}h=true}}return i}};return Constr}();eXide.namespace("eXide.browse.CollectionBrowser");
eXide.browse.CollectionBrowser=function(){Constr=function(d){var e=this;this.events={activate:[]};this.selected=null;var f=document.createElement("div");f.className="eXide-browse-toolbar";d.appendChild(f);var h=document.createElement("button");h.title="Reload";var i=document.createElement("img");i.src="images/arrow_refresh.png";h.appendChild(i);$(h).click(function(a){a.preventDefault();e.reload()});f.appendChild(h);f=document.createElement("div");f.className="eXide-browse-collections eXide-browse-content";
d.appendChild(f);this.container=$(f);this.container.dynatree({persist:false,rootVisible:false,initAjax:{url:"collections.xql"},clickFolderMode:1,onActivate:function(a){a=a.data.key;$.log("activate %s",a);e.selected=a;e.$triggerEvent("activate",[a])},onPostInit:function(){var a;if(e.selected){$.log("prevKey: %s",e.selected);a=this.getNodeByKey(e.selected)}else a=this.getNodeByKey("/db");a.activate();a.expand(true)}})};Constr.prototype={getSelection:function(){return this.selected},reload:function(){$.log("Reloading tree...");
this.container.dynatree("getTree").reload()},addEventListener:function(d,e,f){(d=this.events[d])&&d.push({obj:e,callback:f})},$triggerEvent:function(d,e){var f=this.events[d];if(f)for(var h=0;h<f.length;h++)f[h].callback.apply(f[h].obj,e)}};return Constr}();eXide.namespace("eXide.browse.ResourceBrowser");
eXide.browse.ResourceBrowser=function(){var d=["name","permissions","owner","group","lastModified"],e=["Name","Permissions","Owner","Group","Last Modified"];Constr=function(f){this.container=f;this.events={activate:[]};var h=document.createElement("table"),i=document.createElement("thead");h.appendChild(i);var a=document.createElement("tr");i.appendChild(a);for(i=0;i<e.length;i++){var c=document.createElement("th");c.appendChild(document.createTextNode(e[i]));a.appendChild(c)}a=document.createElement("tbody");
h.appendChild(a);f.appendChild(h);this.view=a;this.activeRow=null};Constr.prototype={update:function(f){$.log("Opening collection %s",f);var h=this;h.activeRow=null;$.getJSON("collections.xql",{root:f,view:"r"},function(i){h.view.innerHTML="";if(i)for(var a=0;a<i.length;a++){var c=a%2==0?"even":"uneven",b=document.createElement("tr");b.className=c;b.style.cursor="pointer";for(c=0;c<e.length;c++){var g=document.createElement("td");g.className=d[c];g.appendChild(document.createTextNode(i[a][c]));b.appendChild(g)}h.view.appendChild(b);
b.doc={name:i[a][0],path:f+"/"+i[a][0],writable:i[a][5]};$(b).click(function(){h.activeRow&&$(h.activeRow).removeClass("eXide-browser-active");h.activeRow=this;$(this).addClass("eXide-browser-active");h.$triggerEvent("activate",[this.doc])})}})},addEventListener:function(f,h,i){(f=this.events[f])&&f.push({obj:h,callback:i})},$triggerEvent:function(f,h){var i=this.events[f];if(i)for(var a=0;a<i.length;a++)i[a].callback.apply(i[a].obj,h)}};return Constr}();eXide.namespace("eXide.browse.Browser");
eXide.browse.Browser=function(){Constr=function(d){var e=document.createElement("div");e.className="eXide-browse-panel";d.appendChild(e);var f=document.createElement("div");f.className="eXide-browse-collections ui-layout-west";e.appendChild(f);var h=document.createElement("div");h.className="eXide-browse-resources ui-layout-center";e.appendChild(h);e=document.createElement("div");e.className="eXide-browse-form";e.style.paddingTop="10px";var i=document.createElement("label");i.appendChild(document.createTextNode("Selection: "));
e.appendChild(i);i=document.createElement("input");i.name="resource";i.type="text";e.appendChild(i);d.appendChild(e);this.selection=i;this.container=d;this.resources=new eXide.browse.ResourceBrowser(h);this.collections=new eXide.browse.CollectionBrowser(f);this.initialized=false;this.collections.addEventListener("activate",this.resources,this.resources.update);this.resources.addEventListener("activate",this,this.$resourceSelected)};Constr.prototype={init:function(){var d=$(this.container).innerHeight()-
$(".eXide-browse-form",this.container).height()-25;$.log("height: %i",d);$(".eXide-browse-panel",this.container).height(d);if(!this.initialized){$(".eXide-browse-panel",this.container).layout({enableCursorHotkey:false,south__resizable:false,west__size:200,west__initClosed:false,west__contentSelector:".eXide-browse-content",center__minSize:300});this.initialized=true}},reload:function(){this.collections.reload();this.resources.update(this.collections.getSelection());$(this.selection).val("")},getSelection:function(){var d=
$(this.selection).val();return{name:d,path:this.collections.getSelection()+"/"+d,writable:true}},$resourceSelected:function(d){$(this.selection).val(d.name)}};return Constr}();