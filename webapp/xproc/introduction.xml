<?xml version="1.0" encoding="UTF-8"?>
<article>
    <articleinfo>
        <graphic fileref="../logo.jpg"/>
        <productname>Open Source Native XML Database</productname>
        <title>XProc Introduction</title>
        <author>
            <firstname>James</firstname>
            <surname>Fuller</surname>
            <affiliation>
                <address format="linespecific"><email>jim.fuller at webcomposite.com</email></address>
            </affiliation>
        </author>
    </articleinfo>
    <xi:include xmlns:xi="http://www.w3.org/2001/XInclude" href="sidebar.xml"/>

    <section>
        <title>XProc Overview</title>
        <para>W3C XProc is a specification that defines a processor for working with XML technologies. eXist XProc implementation is called <b>xprocxq</b> and is mostly developed in XQuery.</para>
		<para>
		Using XProc's <a href="">core</a>, <a href="">standard</a>, <a href="">optional</a> and <a href="">extension</a> steps one defines XML pipelines which can model a wide range of processes.
		</para>
		<para>
		Steps accept input XML and produce output XML, its in this manner (somewhat analogous to unix pipes) that you can orchestrate and create sophisticated XML workflows. </para>
    </section>

    <section>
        <title>Configuration &amp; Quick Start</title>
        <para>Since eXist v1.3 (???1.4), xprocxq is built and configured by defualt with eXist and should be enabled and ready to use. Check out some simple <a href="examples.xml">examples</a> to check if your eXist is working.
		</para>
    </section>

    <section>
        <title>Learning XProc</title>
		<para>XProc pipelines accept zero or more XML documents as their input and produce zero or more XML documents as output. The XProc code in the following listing consists of a &lt;p:pipeline&gt; top-level element, a &lt;p:xslt&gt; step, and not much else. An XML document that comes into the standard input of the XProc processor is handed off to the &lt;p:xslt&gt; step, which then applies an XSLT process using mystylesheet.xslt (where mystylesheet is defined by the &lt;p:input&gt;/&lt;p:document&gt;  element) on the XML document.
			</para>

			<example>
			<title>Simple Pipeline - XSLT transformation</title>
			<programlisting>
			<markup>
				<![CDATA[
				<p:declare-step xmlns:p="http://www.w3.org/ns/xproc" name="xslt-example">
					<p:input port="source" primary="true" sequence="false"/>
					<p:output port="result" primary="true" sequence="false"/> 
					<p:xslt name="step1">
						<p:input port="source">       
							<p:pipe step="xslt-example" port="source"/>     
						</p:input>
						<p:input port="stylesheet">
							<p:document href="mystylesheet.xslt"/>
						</p:input>
					</p:xslt>
				</p:declare-step>
				]]>			
			</markup>
			</programlisting>
			<a href="simple-pipeline.xproc" target="_example">run simple-pipeline.xproc</a>
			</example>
			
	<para>With only a single step, results are placed onto the result port for the entire pipeline, which then outputs the XML document to standard output. The following figure shows this process, outlining where the XML document flows from source and result ports.
	</para>
	
	<graphic fileref="resource/image/processflow.gif"/>

	<para>
		In the Simple Pipeline listing, I used <code>&lt;p:pipeline&gt;</code>, which implicitly declared a source input and result output port. Using <code>&lt;p:declare-step&gt;</code> now means that I have to explicitly define these ports as well as declare step bindings between sequential sibling steps. These bindings and ports are summarized below:
		<ul>
		    <li>Top-level <b>source</b> input port will receive any standard input.</li>
		    <li>Top-level <b>result</b> output port will receive the results of the step1 result port and place them on the standard output.</li>
		    <li>step1 source input is bound to the <b>source</b> input port.</li>
		</ul>

		With a one step pipeline, it's difficult to illustrate step bindings between steps; so, I have created a nontrivial example which contains several steps. The next code listing presents a more representative XProc example containing multiple steps along with some conditional logic steps.	
	</para>

	<example>
	<title>Complex Pipeline - p:choose and p:for-each</title>
	<programlisting>
	<markup>
		<![CDATA[
		<p:pipeline name="mypipeline" type="myexample" xmlns:p="http://www.w3.org/ns/xproc">
			<p:xinclude name="step1"/>
			<p:choose name="step2">
				<p:when test="/*[@version &lt; 2.0]">
					<!-- subpipeline //-->
					<p:validate-with-xml-schema name="step2a1">
						<p:input port="schema">
							<p:document href="newer-schema.xsd"/>
						</p:input>
					</p:validate-with-xml-schema>
				</p:when>
				<p:otherwise>
					<!-- subpipeline //-->
					<p:validate-with-xml-schema name="step2b1">
						<p:input port="schema">
							<p:document href="older-schema.xsd"/>
						</p:input>
					</p:validate-with-xml-schema>
				</p:otherwise>
			</p:choose>
			<p:for-each name="step3">
				<p:iteration-source select="//div"/>
				<!-- subpipeline //-->
				<p:string-replace name="step3a1">
					<p:option name="match" value="//span[@class=’css1’]"/>
					<p:option name="replace" value=""/>
				</p:string-replace>
			</p:for-each>
			<p:wrap-sequence name="step4">
				<p:option name="wrapper" value="document"/>
			</p:wrap-sequence>
		</p:pipeline>
		]]>			
	</markup>
	</programlisting>
	<a href="complex-pipeline.xproc" target="_example">run complex-pipeline.xproc</a>
	</example>
	
	<para>
		This pipeline roughly translates to the following:
		<ul>
		   <li>1. Input stdin XML documents.</li>
		   <li>2. Apply &lt;xinclude&gt; processing (step1).</li>
		   <li>3. Choose (step2) between using an newer (step2a1) or older (step2b1) schema and validate.</li>
		   <li>4. Extract each (step3) HTML &lt;div&gt; element, applying a string replace operation (step3a1).</li>
		   <li>5. Wrap up (step4) the final sequence of &lt;div&gt; elements with a &lt;document&gt; element.</li>
		   <li>6. Output the XML documents to stdout.</li>
		</ul>
		Steps can have other input or output ports defined that work with non-XML documents, but only XML documents (as in XML infoset) can flow between primary input and output ports.
	</para>
	<para>
		I used all three kinds of XProc steps in this example. Step types are represented as rectangles in the workflow diagram below.
	</para>
	
	<graphic fileref="resource/image/xproc_complex_pipeline.gif"/>
	
	
	<para>
		The largest rectangle represents the whole &lt;p:pipeline&gt;, which can itself be invoked as a step. Because it contains a sub-pipeline, it is a <a href="">compound</a> step.</para>
	<para>
		The &lt;p:choose&gt; step has two sub-pipelines, which makes it a <a href="">multi-container</a> step. It chooses which sub-pipeline to follow based on the evaluation of a &lt;p:when&gt; XPath expression.
	</para>
	<para>
		The &lt;p:for-each&gt; step contains a single sub-pipeline consisting of one step, so it's also <a href="">compound</a> step.
	</para>
	<para>
		Most of XProc steps are <a href="" target="_spec">atomic</a> steps. These steps apply a specific operation to an XML document, examples of which are &lt;p:xinclude&gt;, &lt;p:validate-&gt;, &lt;p:string-replace&gt;, and &lt;p:wrap&gt;.
	</para>
	

	<section>
		<title><a href='components-xproc-steps.xml'>XProc Components</a></title>
		<para>
			<ul>
				<li>input and output ports: </li>
				<li>p:pipe, p:inline, p:document, p:data and p:empty: </li>
				<li>p:log: </li>
				<li>p:serialization: </li>
				<li>p:log: </li>
				<li>variables,options and parameters: </li>
				<li>p:declare-step: </li>
				<li>p:library and p:import: </li>

			</ul>
		</para>
	</section>

	
		<section>
			<title><a href='core-xproc-steps.xml'>Core Steps</a></title>
			<para>
				<ul>
					<li><a href="core-xproc-steps.xml#pipeline">p:pipeline</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.pipeline" target="_spec">spec</a>]: </li>
					<li><a href="core-xproc-steps.xml#foreach">p:for-each</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.for-each" target="_spec">spec</a>]: </li>
					<li><a href="core-xproc-steps.xml#viewport">p:viewport</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.viewport" target="_spec">spec</a>]: </li>
					<li><a href="core-xproc-steps.xml#group">p:group</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.group" target="_spec">spec</a>]: </li>
					<li><a href="core-xproc-steps.xml#choose">p:choose</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.choose" target="_spec">spec</a>]: </li>
					<li><a href="core-xproc-steps.xml#try">p:try</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.try" target="_spec">spec</a>]: </li>
				</ul>
			</para>
		</section>


		<section>
			<title><a href='standard-xproc-steps.xml'>Standard Steps</a></title>
			<para>
				<ul>
				<li><b><a href="standard-xproc-steps.xml#addattribute">p:add-attribute</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Add
											an attribute to a set of matching elements.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:add-xml-base</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Add
											or correct <code>xml:base</code> attributes
											on elements.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:compare</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Compare
											two documents for equivalence.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:count</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Count the
											number of documents in source input.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:delete</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Delete items
											specified by a match pattern from the source input.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:directory-list</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Enumerate
											the directory listing into the result output.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:error</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Generate a
											dynamic error.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:escape-markup</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Escape
											source input.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:http-request</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Interact with
											resources identified by Internationalized Resource Identifiers (IRIs)
											over HTTP.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:identity</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Make an exact
											copy of an input source to the result output.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:insert</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Insert an XML
											selection into the source input.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:label-elements</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Create a
											label for each matched element, and store the value of the label in
											an attribute.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:load</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Load an XML
											resource that an IRI specifies and provide it as result output.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:make-absolute-uris</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Make
											the value of an element or attribute in the source input an absolute IRI
											value in the result output .
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:namespace-rename</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Rename
											the namespace declarations.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:pack</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Merge two
											document sequences.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:parameters</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Make available
											a set of parameters as a <code>c:param-set</code> XML
											document in the result output.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:rename</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Rename elements,
											attributes, or processing instruction.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:replace</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Replace matching
											elements.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:set-attributes</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Set attributes
											on matching elements.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:sink</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Accept source input and
											generate no result output.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:split-sequence</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Divide a single
											sequence into two.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:store</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Store a serialized
											version of its source input to a URI.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:string-replace</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b>Perform string
											replacement on the source input.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:unescape-markup</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Unescape
											the source input.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:unwrap</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Replace matched elements
											with their children.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:wrap</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Wrap matching nodes
											in the source document with a new parent element.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:wrap-sequence</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Produce a
											new sequence of documents.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:xinclude</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Apply XInclude
											processing to the input source.
										</li>
				                        <li>
				                            <b>
				                                <a href="standard-xproc-steps.xml#addattribute">p:xslt</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Apply an XSLT
											version 1.0 or XSLT version 2.0 style sheet input source.
										</li>
				</ul>
			</para>
		</section>

		<section>
			<title><a href='optional-xproc-steps.xml'>Optional Steps</a></title>
			<para>
				
				<ul>
				<li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:exec</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Apply an external
											command to the input source.
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:hash</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Generate a message
											digest or a digital fingerprint for some value.
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:uuid</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Generate a
											Universally Unique Identifier (UUID).
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:validate-with-relax-ng</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Validate
											the input XML with RelaxNG schema.
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:validate-with-schematron</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Validate
											the input XML with Schematron schema.
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:validate-with-xml-schema</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Validate
											the input XML with XML schema.
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:www-form-urldecode</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Decode
											the x-www-form-urlencoded string into a set of XProc parameters.
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:www-form-urlencode</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Encode
											a set of XProc parameter values as an x-www-form-urlencoded string.
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:xquery</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Apply an XQuery
											version 1.0 query.
										</li>
				                        <li>
				                            <b>
				                                <a href="optional-xproc-steps.xml#addattribute">p:xsl-formatter</a> [<a href="http://www.w3.org/XML/XProc/docs/langspec.html#p.add-attribute">spec</a>]:</b> Render an
											XSL version 1.1 document (as in XSL-FO).
										</li>
									</ul>
			</para>
		</section>
		
		<section>
			<title><a href='extension-xproc-steps.xml'>Extension Steps</a></title>
			<para>Implementation specific steps</para>
		</section>
	
		<section>
			<title><a href='functions-xproc-steps.xml'>XProc Functions</a></title>
			<para>
			<ul>
				<li>p:system-property(string property)</li>
				<li>p:step-available(string step-type)</li>
				<li>p:iteration-position()</li>
				<li>p:iteration-size()</li>
				<li>p:base-uri()</li>
				<li>p:resolve-uri(String relative)</li>					
			</ul>
			</para>
		</section>
				
		</section>
		
	    
		<section>
			<title>Additional XProc Resources</title>
			<section>
				<title>Mailing Lists</title>
			<ul>
			<li>W3C XProc dev mailing list xproc-dev@w3.org</li>
			</ul>
			</section>
			<section>
				<title>XProc articles</title>
			<ul>
			<li><a href="http://www.ibm.com/developerworks/library/x-xproc/" target="_resource"> Jim Fuller 'Discovering XProc' IBM Developworks 2008</a></li>

			<li><a href="http://www.xmlprague.cz/2009/presentations/Norman-Walsh-Exploring-XProc/index.html" target="_resource">Norman Walsh XML Prague 2009 XProc Talk</a></li>
		<li><a href="http://www.xmlprague.cz/2009/presentations/Vojtech-Toman-Optimizing-XML-Content-Delivery-with-XProc.pdf" target="_resource">Vojtěch Toman XLM Prague 2009 XProc Talk</a></li>
			</ul>
		</section>
		
			<section>
				<title>XProc Specifications</title>
			<ul>
			<li><a href="http://www.w3.org/XML/XProc/docs/langspec.html" target="_resource">XProc</a>: An XML Pipeline Language]: Explore this W3C XProc Editors Draft (the W3C working draft dated 01 May 2008).</li>


			<li><a href="http://www.w3.org/XML/XProc/docs/langspec.html#namespace-fixup-guidance" target="_resource"> XProc: Section E. Guidance on Namespace Fixup</a>: Review the non-normative list of suggestions for implementors to follow to reduce the need to fix up namespaces.</li>


			<li><a href="http://tests.xproc.org" target="_resource">XProc W3C unit test suite</a>: Repository where draft unit test suite for XProc is being developed.</li>
		</ul>
			</section>
		
			<section>
				<title>Useful</title>
			<ul>
			<li><a href="http://xproc.org" target="_resource">xproc.org</a></li>

			<li><a href="http://xproc.org/implementations/" target="_resource">XProc implementations</a></li>

			<li><a href="http://www.dpawson.co.uk/xproc/index.html" target="_resource">Dave Pawson XProc introduction</a></li>
		</ul>
			</section>
			<section>
				<title>EXProc, EXpath and EXQuery Community Specifications</title>
			<ul>
			<li><a href="http://exprog.org" target="_resource">EXProc</a>: Intended to be a place to discuss and define extension steps to XProc.</li>

			<li><a href="http://expath.org" target="_resource">EXPath</a>: Community defined extensions to XPath. Currently, xprocxq uses expath http-client module.</li>

			<li><a href="http://exquery.org" target="_resource">EXQuery</a>: Community defined extensions to XQuery. Predicted that xprocxq will use any output from this effort.</li>
		</ul>
		</section>
		<section>
			<title>XQuery</title>
			<ul>
				
			<li><a href="http://www.ibm.com/developerworks/edu/x-dw-x-advxquery.html" target="_resource">Jim Fuller's Advancing with XQuery</a>: IBM Developerworks article on implementing application idioms in XQuery</li>

			<li><a href="http://en.wikibooks.org/wiki/XQuery/" target="_resource"> XQuery WikiBooks</a>: Excellent XQuery reference led by Chris Wallace et al.</li>

			<li><a href="http://thewallaceline.blogspot.com/2009/04/xquery-unit-tests.html" target="_resource">Chris Wallace Unit Testing</a>: Nice article on the right way to do Unit Testing in XQuery</li>

			<li><a href="http://code.google.com/p/xprocxq/source/browse/trunk/main/test/xquery/test.xqm" target="_resource">Jim Fuller 'poor mans' XQuery unit testing</a>: simple XQuery module for facilitating tests that I developed during development of xprocxq.</li>
		</ul>
		</section>

			<section>
				<title>Historical XProc links</title>
			<ul>
			<li><a href="http://www.w3.org/TR/2002/NOTE-xml-pipeline-20020228/" target="_resource">XML Pipeline Definition Language Version 1.0: W3C Note 28 February 2002</a>: Read the note submitted by Sun Microsystems, Alis Technologies, Arbortext, Cisco Systems, Fujitsu, Markup Technology, and Oracle.</li>

			<li><a href="http://www.w3.org/TR/2004/NOTE-proc-model-req-20040405/NOTE-proc-model-req-20040405.xml" target="_resource">XML Processing Model Requirements: W3C Working Group Note 05 April 2004</a>: Peruse the W3C WG Note from 05 April 2004.</li>

			<li><a href="http://www.w3.org/Submission/2005/SUBM-xpl-20050411/" target="_resource">XML Pipeline Language (XPL) Version 1.0 (Draft)</a>: Review the W3C Member Submission submitted by Orbeon on 11 March 2005 and published on 11 April 2005.</li>

			<li><a href="http://www.w3.org/XML/XProc/docs/diff.html" target="_resource"> XProc: An XML Pipeline Language (with revision marks)</a>: Peruse the W3C Working Draft with differences dated 8 May 2008.</li>

			<li><a href="http://www.w3.org/TR/xproc-requirements/" target="_resource">XML Processing Model Requirements and Use Cases</a>: Read the W3C XProc requirements and use cases document dated 11 April 2006.</li>

			<li><a href="http://www.w3.org/Submission/xpl/" target="_resource">XML Pipeline Language (XPL) Version 1.0 (Draft)</a>: Check out this draft of the early W3C member submission of an XML pipeline language.</li>
			</ul>
		</section>
	</section>

    <section>
        <title>xprocxq FAQ</title>

<section>
	<title>xprocxq limitations</title>
<para>
	xprocxq, being implemented in XQuery, currently has several limitations and is no where compliant with the existing XProc draft specification. The best way to understand what works or doesn't currently is to check out step examples included in the release.
</para>
<para>
	Here is a list of the more severe limitations:
<ul>
	    <li>when selecting elements in a namespace u will have to generically select them</li>

	    <li>due to my use of weak typing in XQuery there are several interrelated issues, but this will change as I sanitize the code</li>

	    <li>have disabled namespace management for the time being which applies XProc namespace fixup rules</li>

	    <li>defining reusable pipelines using p:library, p:import and p:declare-step is currently disabled</li>

	    <li>errors are thrown as XQuery errors, making it difficult to report correct line numbers, not to mention that errors themselves look quite ugly</li>

	    <li>p:choose xpath-context, iteration, etc is not implemented just yet</li>

	    <li>some step sorting issues (specifically intermixing of steps using p:inline), best to use explicit port binding to completely avoid.</li>

	    <li>p:xquery currently uses a c:result element to output, I also added a xproc:escape attribute to c:query to avoid having to wrap XQuery using CDATA (which is XProc spec requirement).</li>

	    <li>declare base-uri affects module imports (need to investigate across all XQuery processors)</li>

	    <li>cant pass required/add-attribute--002.xml test depends on namespace handling module to be finished</li>

	    <li>errors and/or p:error does not write to error port (also discussing need for a generic 'implementator specific error code' with XProc WG)</li>

	    <li>current preparsing routine is naive; I have a more rigorous solution in a source control branch to merge</li>
	</ul>
</para>
</section>
	
    <section>
        <title>Why is xprocxq implemented in XQuery ?</title>
        <para>
        	XQuery's somewhat functional approach appealed to me and having been a long time XSLT user I wanted to gain some understanding of the nuances between XSLT and XQuery.</para>
		<para>
			In building xqueryxq, my primary goals were;
			<ul>
				<li>creating an implementation in XQuery meant that XProc processor will be as
					performant as the underlying XQuery implementation and be able to naturally process XML data stored in XML Database.</li>
			    	<li>Exercise fundamental FP principles building a non trivial XQuery application. I think I have achieved this goal, as xprocxq 'main engine' is the u:step-fold function (in util.xqm) which operates on simple pipelines.</li>
			    <li>To understand variability between XQuery processors. I think there is a surprising amount of differences between XQuery processors, but thankfully mostly in the form of extension functions, implicit type casting and in smaller part some interpretations of the spec (where the spec allowed for impl to do things as they see fit). The real impact though is that we need things like EXPath and EXQuery to allow for even a remote chance of compatibility between XQuery processors</li>
			</ul>
		</para>
		<para>I think that most people will find using XProc with XQuery is a powerful combination which can be used to implement a wide range of server side applications.
        </para>
    </section>
</section>
</article>
