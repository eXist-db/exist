<?xml version="1.0" encoding="UTF-8"?>

<!-- ======================================================================= -->
<!-- eXist build file : Setup default xar packages                           -->
<!-- ======================================================================= -->

<!-- $Id$ -->

<project basedir="../.." name="Setup" default="setup">

  <description>Package setup tasks</description>
  
  <!-- Additional task defs  -->
  <taskdef resource="net/sf/antcontrib/antcontrib.properties">
    <classpath>
      <pathelement location="tools/ant/lib/ant-contrib-1.0b3.jar"/>
    </classpath>
  </taskdef>
  
  <property file="build.properties"/>
  
  <property name="public-repo" value="http://demo.exist-db.org/exist/apps/public-repo/public/"/>
  <property name="autostart-dir" value="autodeploy"/>
  
  <target name="prepare">
    <mkdir dir="${autostart-dir}"/>
    <!--  Automatically download standard xar packages from public repository
        if autostart directory is empty.
  -->
    <path id="autostart-files">
      <fileset dir="${autostart-dir}">
        <include name="*.xar"/>
      </fileset>
    </path>
    
    <property name="autostart-files" refid="autostart-files"/>
    
    <condition property="autostart-empty"> 
      <equals arg1="" arg2="${autostart-files}"/> 
    </condition>
  </target>
  
  <!-- 
    Download xar files from the package website.
  -->
  <target name="setup" depends="prepare" description="Download standard xar packages." if="autostart-empty">
    <foreach list="${autodeploy}" target="download-xar" param="xar"></foreach>
  </target>
  
  <target name="download-xar">
      
    <taskdef name="fetch" classname="nl.ow.dilemma.ant.fetch.FetchTask">
        <classpath>
          <pathelement location="tools/ant/lib/asocat-exist.jar"/>
        </classpath>
    </taskdef>
    <fetch dest="${autostart-dir}" url="${public-repo}/${xar}"/>
  </target>
</project>
