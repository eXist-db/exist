/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["betterform.ui.container.Repeat"]){dojo._hasResource["betterform.ui.container.Repeat"]=true;dojo.provide("betterform.ui.container.Repeat");dojo.require("betterform.ui.container.Container");dojo.require("dojo.NodeList-fx");dojo.declare("betterform.ui.container.Repeat",betterform.ui.container.Container,{createdRepeatItems:null,itemsToRemoveList:[],postCreate:function $DA1Q_(){this.inherited(arguments);this.createdRepeatItems=new Array();},handleSetRepeatIndex:function $DA1R_(_1){if(eval(_1.index)==0){return;}this._removeRepeatIndexClasses();var _2;if(dojo.hasClass(this.domNode,"xfCompactRepeat")){_2=dojo.query("> tbody > .xfRepeatItem",this.domNode)[_1.index-1];}else{_2=dojo.query("> .xfRepeatItem",this.domNode)[_1.index-1];}if(_2!=undefined){dojo.addClass(_2,"xfRepeatIndex");}},setFocusOnChild:function $DA1S_(_3){var _4=dojo.query(".xfValue",_3)[0];if(_4!=undefined){_4.focus();}else{var _5=dojo.query(".xfTrigger button")[0];if(_5==undefined){_5=dojo.query("input")[0];if(_5==undefined){_5=window.document.body.firstChild();}}_5.focus();}},handleInsert:function $DA1T_(_6){this._removeRepeatIndexClasses();var _7=dojo.byId(_6.originalId+"-prototype");var _8=_7.cloneNode(true);this._replaceRepeatItemClasses(_8);var _9="";if(_6.prototypeId!=undefined){_9=_6.generatedIds;dojo.attr(_8,"id",_9[_6.prototypeId]);}else{if(_6.repeatedSelects){_9=_6.repeatedSelects[0].generatedIds;var _a=_6.repeatedSelects[0].generatedIds[0];dojo.attr(_8,"id",_a);}}this._replacePrototypeIds(_8,_9);var _b=eval(_6.position);var _c=this._createRepeatItem(_8,_b);dojo.query("*[unbound='true']",_c.domNode).forEach(function(_d){var _e=new betterform.ui.Control({},_d);});_c.showRepeatItem();},_replaceRepeatItemClasses:function $DA1U_(_f){dojo.removeClass(_f,"xfRepeatPrototype");dojo.removeClass(_f,"xfDisabled");dojo.addClass(_f,"xfRepeatItem");dojo.addClass(_f,"xfEnabled");dojo.addClass(_f,"xfRepeatIndexPre");},_replacePrototypeIds:function $DA1V_(_10,_11){dojo.query("*",_10).forEach(function(_12){var _13=dojo.attr(_12,"id");var _14=dojo.attr(_12,"repeatid");if(_14!=undefined&&_11[_14]!=undefined){dojo.attr(_12,"repeatid",_11[_13]);}if(_13!=undefined&&_11[_13]!=undefined){dojo.attr(_12,"id",_11[_13]);}else{if(_13!=undefined){var _15;var _16;if(_13.indexOf("-value")!=-1){_15=_13.substring(0,_13.indexOf("-value"));_16="-value";}else{if(_13.indexOf("-label")!=-1){_15=_13.substring(0,_13.indexOf("-label"));_16="-label";}else{if(_13.indexOf("-hint")!=-1){_15=_13.substring(0,_13.indexOf("-hint"));_16="-hint";}else{if(_13.indexOf("-help")!=-1){_15=_13.substring(0,_13.indexOf("-help"));_16="-help";}else{if(_13.indexOf("-alert")!=-1){_15=_13.substring(0,_13.indexOf("-alert"));_16="-alert";}else{return;}}}}}var _17=_11[_15]+_16;dojo.attr(_12,"id",_17);}}});},_createRepeatItem:function $DA1W_(_18,_19){var _1a=_19;var _1b=this._getSize();var _1c;if(dojo.hasClass(this.domNode,"xfFullRepeat")){_1c="full";}else{_1c="compact";}var _1d=new betterform.ui.container.RepeatItem({repeatId:this.id,appearance:_1c},_18);_1d.hideRepeatItem();var _1e=null;if(_19==1&&_1b>0){if(dojo.hasClass(this.domNode,"xfCompactRepeat")){_1e=dojo.query("> tbody > .xfRepeatItem",this.domNode)[0];}else{_1e=dojo.query("> .xfRepeatItem",this.domNode)[0];}dojo.place(_1d.domNode,_1e,"before");}else{if(_19==1&&_1b==0){if(dojo.hasClass(this.domNode,"xfCompactRepeat")){var _1f=dojo.query("tbody",this.domNode)[0];if(_1f==undefined){_1f=dojo.doc.createElement("tbody");dojo.place(_1f,this.domNode);}dojo.place(_1d.domNode,_1f);}else{dojo.place(_1d.domNode,this.domNode);}}else{if(dojo.hasClass(this.domNode,"xfCompactRepeat")){_1e=dojo.query("> tbody > .xfRepeatItem",this.domNode)[_1a-2];}else{_1e=dojo.query("> .xfRepeatItem",this.domNode)[_1a-2];}dojo.place(_1d.domNode,_1e,"after");}}return _1d;},_getSize:function $DA1X_(){var _20;if(dojo.hasClass(this.domNode,"xfCompactRepeat")){_20=dojo.query("> tbody > .xfRepeatItem",this.domNode).length;}else{_20=dojo.query("> .xfRepeatItem",this.domNode).length;}return _20;},_getRepeatItems:function $DA1Y_(){var _21;if(dojo.hasClass(this.domNode,"xfCompactRepeat")){_21=dojo.query("> tbody > .xfRepeatItem",this.domNode);}else{_21=dojo.query("> .xfRepeatItem",this.domNode);}return _21;},handleDelete:function $DA1Z_(_22){var _23=eval(_22.position);var _24;if(dojo.hasClass(this.domNode,"xfCompactRepeat")){_24=dojo.query("> tbody > .xfRepeatItem",this.domNode)[_23-1];dojo.query("> tbody",this.domNode)[0].removeChild(_24);}else{_24=dojo.query("> .xfRepeatItem",this.domNode)[_23-1];this.domNode.removeChild(_24);}},handleStateChanged:function $DA1a_(_25){var _26=eval(_25["enabled"]);if(_26){betterform.ui.util.replaceClass(this.domNode,"xfDisabled","xfEnabled");}else{betterform.ui.util.replaceClass(this.domNode,"xfEnabled","xfDisabled");}},_removeRepeatIndexClasses:function $DA1b_(){if(dojo.hasClass(this.domNode,"xfCompactRepeat")){dojo.query("> tbody > .xfRepeatIndexPre",this.domNode).forEach(function(_27){dojo.removeClass(_27,"xfRepeatIndexPre");});dojo.query("> tbody > .xfRepeatIndex",this.domNode).forEach(function(_28){dojo.removeClass(_28,"xfRepeatIndex");});}else{dojo.query("> .xfRepeatIndexPre",this.domNode).forEach(function(_29){dojo.removeClass(_29,"xfRepeatIndexPre");});dojo.query("> .xfRepeatIndex",this.domNode).forEach(function(_2a){dojo.removeClass(_2a,"xfRepeatIndex");});}}});}