/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["betterform.ui.input.DateTime"]){dojo._hasResource["betterform.ui.input.DateTime"]=true;dojo.provide("betterform.ui.input.DateTime");dojo.require("betterform.ui.ControlValue");dojo.require("dijit.form.DateTextBox");dojo.require("dijit.form.TimeTextBox");dojo.declare("betterform.ui.input.DateTime",betterform.ui.ControlValue,{templateString:"<div class=\"xfDateTimeControl\"\n    ><input\n        type=\"text\" dojoAttachPoint=\"dateFacet\" value=\"\" class=\"xfValue xfDateTextBox\" dojoType=\"dijit.form.DateTextBox\" required=\"true\" style=\"width:100px\"\n    /><input type=\"text\" dojoAttachPoint=\"timeFacet\" value=\"\" class=\"xfValue xfTimeTextBox\" dojoType=\"dijit.form.TimeTextBox\" required=\"true\" style=\"width:100px\"\n            constraints=\"{ timePattern:'HH:mm:ss'}\"\n/></div>\n",id:null,widgetsInTemplate:true,dateDijit:null,timeDijit:null,constraints:null,timezone:null,postMixInProperties:function $DA2t_(){this.inherited(arguments);this.applyProperties(dijit.byId(this.xfControlId),this.srcNodeRef);},postCreate:function $DA2u_(){this.inherited(arguments);dojo.attr(this.domNode,"value",this.value);this.applyValues(this.value);},_onFocus:function $DA2v_(){this.inherited(arguments);this.handleOnFocus();},_onBlur:function $DA2w_(){this.incremental=false;this.handleOnBlur();},applyValues:function $DA2x_(_1){if(_1.indexOf("+")!=-1){this.timezone=_1.substring(_1.indexOf("+"),_1.length);_1=_1.substring(0,_1.indexOf("+"));}if(_1.indexOf("Z")!=-1){this.timezone="Z";_1=_1.substring(0,_1.indexOf("Z"));}var _2;var _3;if(_1!=undefined&&_1!=""){var _4=_1.split("T");_2=dojo.date.stamp.fromISOString(_4[0],this.constraints);_3=dojo.date.stamp.fromISOString("T"+_4[1],this.constraints);}else{_2="";_3="";}if(this.dateDijit==undefined){this.dateDijit=dijit.byId(this.dateFacet.id);if(this.constraints.formatLength!=undefined){this.dateDijit.constraints.formatLength=this.constraints.formatLength;}if(this.constraints.locale!=undefined){this.dateDijit.constraints.locale=this.constraints.locale;}if(this.constraints.datePattern!=undefined){this.dateDijit.constraints.datePattern=this.constraints.datePattern;}this.dateDijit.constraints.selector="date";}this.dateDijit._setValueAttr(_2);if(this.timeDijit==undefined){this.timeDijit=dijit.byId(this.timeFacet.id);if(this.constraints.formatLength!=undefined){this.timeDijit.constraints.formatLength=this.constraints.formatLength;}if(this.constraints.locale!=undefined){this.timeDijit.constraints.locale=this.constraints.locale;}if(this.constraints.timePattern!=undefined){this.timeDijit.constraints.timePattern=this.constraints.timePattern;}this.timeDijit.constraints.selector="time";}this.timeDijit._setValueAttr(_3);this.setCurrentValue(_1);},getControlValue:function $DA2y_(){var _5;var _6=this.dateDijit.attr("value");if(_6==undefined){_5=this.dateDijit.focusNode.value;}else{_5=dojo.date.stamp.toISOString(_6,this.constraints);}if(_5==undefined){_5="";}else{if(_5.length==25&&_5.indexOf("T")==10){_5=_5.substring(0,11);}}var _7=this.timeDijit.textbox.value;if(_7==undefined){_7="";}else{if(_7.length==5&&_7.indexOf(":")==2){_7+=":00";}}if(_7.length==8&&_7.indexOf(":")==2&&this.miliseconds){_7+=".000";}if((_7.length==12||_7.length==8)&&_7.indexOf(":")==2&&this.value.indexOf("Z")!=-1){_7+="Z";}else{if(this.timezone!=undefined){_7+=this.timezone;}}this.value=_5+_7;return this.value;},_handleSetControlValue:function $DA2z_(_8){if(this.miliseconds&&_8.indexOf(".")!=-1){_8=_8.substring(0,_8.indexOf("."));}this.applyValues(_8);},applyState:function $DA20_(){if(this.xfControl.isReadonly()){this.dateDijit.attr("disabled",true);this.timeDijit.attr("disabled",true);}else{this.dateDijit.attr("disabled",false);this.timeDijit.attr("disabled",false);}}});}