/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["betterform.ui.Control"]){dojo._hasResource["betterform.ui.Control"]=true;dojo.provide("betterform.ui.Control");dojo.require("dijit._Widget");dojo.require("betterform.ui.UIElementFactory");dojo.require("dijit.Dialog");dojo.require("dijit.form.Button");dojo.declare("betterform.ui.Control",[dijit._Widget,dijit._Templated],{id:"",target:null,value:"",dataType:"",controlType:"",valid:true,readonly:false,required:false,relevant:true,controlValue:null,contextInfo:null,tabindex:0,appearance:"",buildRendering:function $DA11_(){this.domNode=this.srcNodeRef;if(dojo.attr(this.domNode,"tabindex")){this.tabindex=eval(dojo.attr(this.domNode,"tabindex"));}},postCreate:function $DA12_(){betterform.ui.util.setDefaultClasses(this.domNode);if(this.controlValue==undefined){var _1=dojo.query("*[id ='"+this.id+"-value']",this.domNode)[0];if(_1==undefined){_1=dojo.query(".xfValue",this.domNode)[0];}if(_1==undefined){_1=this._createControlValueTemplate();}else{this.dataType=betterform.ui.util.removeNamespace(dojo.attr(_1,"datatype"));this.controlType=dojo.attr(_1,"controltype");}this.controlValue=fluxProcessor.factory.createWidget(_1,this.id);if(this.controlValue!=undefined){this.controlValue.applyState();}else{console.error("ControlValue for Control "+id+" could not be created");}}if(this.isValid()){dojo.publish("/xf/valid",[this.id,"init"]);}else{dojo.publish("/xf/invalid",[this.id,"init"]);}},_createControlValueTemplate:function $DA13_(){if(this.contextInfo.type!=undefined&&this.contextInfo.type!=""){var _2=betterform.ui.util.removeNamespace(this.contextInfo.type);_2="xsd"+_2.replace(/^[a-z]/,_2.substring(0,1).toUpperCase());if(dojo.hasClass(this.domNode,"xsd")){betterform.ui.util.replaceClass(this.domNode,"xsd",_2);}else{dojo.addClass(this.domNode,_2);}}else{if(dojo.hasClass(this.domNode,"xsd")){console.warn("Control.postCreate Control "+this.id+" has no type but xsd on it's prototype");}}this._updateMIPClasses();var _3=document.createElement("span");this.dataType=betterform.ui.util.removeNamespace(this.contextInfo.type);this.controlType=this.contextInfo.targetName;dojo.attr(_3,"dataType",this.dataType);dojo.attr(_3,"controlType",this.controlType);if(this.contextInfo.value!=undefined&&this.dataType=="date"){this.controlType=dojo.attr(_3,"schemaValue",this.contextInfo.schemaValue);}if(this.contextInfo.targetId!=undefined){this.controlType=dojo.attr(_3,"id",this.contextInfo.targetId+"-value");}if(dojo.attr(this.domNode,"appearance")!=undefined){this.appearance=dojo.attr(this.domNode,"appearance");dojo.attr(_3,"appearance",this.appearance);}if(dojo.attr(this.domNode,"mediatype")!=undefined){this.appearance=dojo.attr(this.domNode,"mediatype");dojo.attr(_3,"mediatype",this.appearance);}if(this.contextInfo.targetName!="trigger"){_3.innerHTML=this.contextInfo.value;}else{dojo.attr(_3,"label",this.srcNodeRef.innerHTML);this.domNode.innerHTML="";}dojo.addClass(_3,"xfValue");dojo.place(_3,this.domNode);if(dojo.hasClass(this.domNode,"xfIncremental")){dojo.attr(_3,"incremental","true");}return _3;},isRequired:function $DA15_(){if(dojo.hasClass(this.domNode,"xfOptional")){return false;}else{if(dojo.hasClass(this.domNode,"xfRequired")){return true;}else{console.error("No required state found");}}},isReadonly:function $DA16_(){if(dojo.hasClass(this.domNode,"xfReadWrite")){return false;}else{if(dojo.hasClass(this.domNode,"xfReadOnly")){return true;}else{console.error("No readonly state found");}}},isRelevant:function $DA17_(){if(dojo.hasClass(this.domNode,"xfDisabled")){return false;}else{if(dojo.hasClass(this.domNode,"xfEnabled")){return true;}else{console.error("No relevant state found");}}},isValid:function $DA18_(){if(dojo.hasClass(this.domNode,"xfInvalid")){return false;}else{if(dojo.hasClass(this.domNode,"xfValid")){return true;}else{console.error("No validate state found for "+this.id);}}},handleStateChanged:function $DA19_(_4){if(_4["parentId"]){this._handleHelperChanged(_4);}else{this.value=_4["value"];this.valid=_4["valid"];this.readonly=_4["readonly"];this.required=_4["required"];this.relevant=_4["enabled"];if(_4["targetName"]=="input"&&this.value!=null){var _5=betterform.ui.util.removeNamespace(_4["type"]);this._changedDataType(_5,_4);if(_5=="date"||_5=="dateTime"){this._handleSetControlValue(_4["schemaValue"]);}else{this._handleSetControlValue(this.value);}}else{if(this.value!=null){this._handleSetControlValue(this.value);}}if(this.valid!=null){this._handleSetValidProperty(eval(this.valid));}if(this.readonly!=null){this._handleSetReadonlyProperty(eval(this.readonly));}if(this.required!=null){this._handleSetRequiredProperty(eval(this.required));}if(this.relevant!=null){this._handleSetEnabledProperty(eval(this.relevant));}}},getControlValue:function $DA2A_(){if(this.controlValue!=undefined){return this.controlValue.getControlValue();}},_changedDataType:function $DA2B_(_6,_7){if(this.controlValue==undefined){var _8=dojo.query("*[id ='"+this.id+"-value']",this.domNode)[0];if(_8==undefined){_8=dojo.query(".xfValue",this.domNode)[0];}if(_8==undefined){console.error("Control.handleStateChanged Error: XFControl "+this.id+" has no ControlValue node");return;}else{dojo.attr(_8,"dataType",_6);dojo.attr(_8,"id",this.id+"-value");this.controlValue=fluxProcessor.factory.createWidget(_8,this.id);}}else{if(this.dataType!=_6&&!(this.dataType==""&&_6=="string")){var _9=document.createElement("span");dojo.attr(_9,"dataType",_6);dojo.attr(_9,"controlType",this.controlType);dojo.attr(_9,"id",this.id+"-value");dojo.addClass(_9,"xfValue");var _a="xsd"+this.dataType.replace(/^[a-z]/,this.dataType.substring(0,1).toUpperCase());if(dojo.hasClass(this.domNode,_a)){dojo.removeClass(this.domNode,_a);}dojo.addClass(this.domNode,"xsd"+_6.replace(/^[a-z]/,_6.substring(0,1).toUpperCase()));this.controlValue.destroy();this.controlValue=fluxProcessor.factory.createWidget(_9,this.id);dojo.place(this.controlValue.domNode,this.domNode);}}this.dataType=_6;},_handleSetControlValue:function $DA2C_(_b){if(this.controlValue.currentValue!=_b){this.controlValue.currentValue=_b;this.controlValue._handleSetControlValue(_b);}},_handleSetValidProperty:function $DA2D_(_c){if(_c){betterform.ui.util.replaceClass(this.domNode,"xfInvalid","xfValid");dojo.publish("/xf/valid",[this.id,"applyChanges"]);}else{betterform.ui.util.replaceClass(this.domNode,"xfValid","xfInvalid");dojo.publish("/xf/invalid",[this.id,"applyChanges"]);}},_handleSetReadonlyProperty:function $DA2E_(){if(eval(this.readonly)==false){betterform.ui.util.replaceClass(this.domNode,"xfReadOnly","xfReadWrite");}else{betterform.ui.util.replaceClass(this.domNode,"xfReadWrite","xfReadOnly");}this.controlValue.applyState();},_handleSetRequiredProperty:function $DA2F_(){if(this.required=="true"){betterform.ui.util.replaceClass(this.domNode,"xfOptional","xfRequired");}else{betterform.ui.util.replaceClass(this.domNode,"xfRequired","xfOptional");if(dojo.hasClass(this.domNode,"xfRequiredEmpty")){dojo.removeClass(this.domNode,"xfRequiredEmpty");}}},_handleSetEnabledProperty:function $DA2G_(_d){var _e=this.id;var _f=dojo.byId(_e+"-label");if(_d){if(_f!=undefined){if(dojo.hasClass(_f,"xfDisabled")){betterform.ui.util.replaceClass(_f,"xfDisabled","xfEnabled");}else{dojo.addClass(_f,"xfEnabled");}}betterform.ui.util.replaceClass(this.domNode,"xfDisabled","xfEnabled");}else{if(_f!=undefined){if(dojo.hasClass(_f,"xfEnabled")){betterform.ui.util.replaceClass(_f,"xfEnabled","xfDisabled");}else{dojo.addClass(_f,"xfDisabled");}}betterform.ui.util.replaceClass(this.domNode,"xfEnabled","xfDisabled");if(this.isValid()){dojo.publish("/xf/valid",[this.id,"xfDisabled"]);}else{dojo.publish("/xf/invalid",[this.id,"xfDisabled"]);}}},_handleHelperChanged:function $DA2H_(_10){switch(_10["targetName"]){case "label":this.controlValue._setLabel(_10["value"]);return;case "help":this._setHelp(_10["value"]);return;case "hint":this._setHint(_10["value"]);return;case "alert":this._setAlert(_10["value"]);return;case "value":this.controlValue._handleSetControlValue(_10["value"]);return;}},_updateMIPClasses:function $DA2I_(){if(this.contextInfo.enabled!=undefined){if(this.contextInfo.enabled=="true"){betterform.ui.util.replaceClass(this.domNode,"xfDisabled","xfEnabled");}else{betterform.ui.util.replaceClass(this.domNode,"xfEnabled","xfDisabled");}}if(this.contextInfo.readonly!=undefined){if(this.contextInfo.readonly=="true"){betterform.ui.util.replaceClass(this.domNode,"xfReadWrite","xfReadOnly");}else{betterform.ui.util.replaceClass(this.domNode,"xfReadOnly","xfReadWrite");}}if(this.contextInfo.required!=undefined){if(this.contextInfo.required=="true"){betterform.ui.util.replaceClass(this.domNode,"xfOptional","xfRequired");}else{betterform.ui.util.replaceClass(this.domNode,"xfRequired","xfOptional");}}if(this.contextInfo.valid!=undefined){if(this.contextInfo.valid=="true"){betterform.ui.util.replaceClass(this.domNode,"xfInvalid","xfValid");}else{betterform.ui.util.replaceClass(this.domNode,"xfValid","xfInvalid");}}},updateProgress:function $DA2J_(_11){this.controlValue.updateProgress(_11);},setControlValue:function $DA2K_(_12){fluxProcessor.setControlValue(this.id,_12);},_setHelp:function $DA2L_(_13){var _14=dojo.byId(this.id+"-help");if(_14!=undefined){_14.innerHTML=_13;}else{console.warn("Failure updating help for Control '"+this.id+"-help' with value: "+_13);}},_setHint:function $DA2M_(_15){var _16=dojo.byId(this.id+"-hint");if(_16!=undefined){_16.innerHTML=_15;}else{console.error("Failure updating hint for Control '"+this.id+"-hint' with value: "+_15);}},_setAlert:function $DA2N_(_17){var _18=dojo.byId(this.id+"-alert");if(_18!=undefined){_18.innerHTML=_17;}else{console.error("Failure updating alert for Control '"+this.id+"-alert' with value: "+_17);}},_setValueChild:function $DA2O_(_19){console.warn("TBD: Control._setValueChild value:"+_19);}});}