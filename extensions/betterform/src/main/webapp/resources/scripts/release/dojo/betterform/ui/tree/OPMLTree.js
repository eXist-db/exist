/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["betterform.ui.tree.OPMLTree"]){dojo._hasResource["betterform.ui.tree.OPMLTree"]=true;dojo.provide("betterform.ui.tree.OPMLTree");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("betterform.ui.ControlValue");dojo.require("dijit.Tree");dojo.require("dojox.data.OpmlStore");dojo.require("dojox.data.dom");dojo.declare("betterform.ui.tree.OPMLTree",betterform.ui.ControlValue,{rootLabel:"Root Node",templateString:"<div class=\"xfTree\"/>\n",instanceId:null,modelId:null,store:null,model:null,tree:null,id:null,controlValue:null,templateString:null,buildRendering:function $DA5j_(){this.inherited(arguments);this.instanceId=dojo.attr(this.srcNodeRef,"instanceId");this.modelId=dojo.attr(this.srcNodeRef,"modelId");this.id=dojo.attr(this.srcNodeRef,"id");},postMixInProperties:function $DA5k_(){this.applyProperties(dijit.byId(this.xfControlId),this.srcNodeRef);},postCreate:function $DA5l_(){this.inherited(arguments);dijit.byId(this.modelId).getInstanceDocument(this.instanceId,dojo.hitch(this,this._initialTreeCreation));},_initialTreeCreation:function $DA5m_(_1){this._createTree(_1);},_createTree:function $DA5n_(_2){this.store=this._createStore(_2);this.model=this._createModel();dojox.data.dom.removeChildren(this.domNode);var _3=dojo.doc.createElement("div");dojo.place(_3,this.domNode);this.tree=this._createTreeImpl(_3);this.tree.startup();dojo.connect(this.tree,"onClick",this,"_treeClicked");this.treeCreated();},_createStore:function $DA5o_(_4){return new dojox.data.OpmlStore({jsid:this.id+"-store",url:"",data:_4});},_createModel:function $DA5p_(){return new dijit.tree.ForestStoreModel({jsid:this.id+"-model",store:this.store,query:{},rootId:this.rootLabel,rootLabel:this.rootLabel});},_createTreeImpl:function $DA5q_(_5){return new dijit.Tree({model:this.model,jsid:this.id+"-tree"},_5);},_treeClicked:function $DA5r_(_6,_7){if(!(this.store.isItem(_6))){return;}this.controlValue=this.store.getValue(_6,"text");this.valueChanged(_6,_7);},_handleSetControlValue:function $DA5s_(_8){this.tree.destroy();this.model.destroy();this.store=undefined;dijit.byId(this.modelId).getInstanceDocument(this.instanceId,dojo.hitch(this,this._createTree));},valueChanged:function $DA5t_(_9,_a){},getControlValue:function $DA5u_(){return this.controlValue;},getStoreValue:function $DA5v_(_b,_c){return this.store.getValue(_b,_c);},treeCreated:function $DA5w_(){}});}