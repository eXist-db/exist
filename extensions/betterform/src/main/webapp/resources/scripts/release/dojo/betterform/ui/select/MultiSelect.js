/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["betterform.ui.select.MultiSelect"]){dojo._hasResource["betterform.ui.select.MultiSelect"]=true;dojo.provide("betterform.ui.select.MultiSelect");dojo.require("dijit.form.FilteringSelect");dojo.require("betterform.ui.ControlValue");dojo.require("dijit.form.MultiSelect");dojo.declare("betterform.ui.select.MultiSelect",[betterform.ui.ControlValue,dijit.form.MultiSelect],{size:"",value:"",multiple:"",freeTextDijit:null,freeTextValue:"",openSelection:false,isServerUpdate:false,postMixInProperties:function $DA4B_(){this.inherited(arguments);this.applyProperties(dijit.byId(this.xfControlId),this.srcNodeRef);if(dojo.attr(this.srcNodeRef,"incremental")==undefined||dojo.attr(this.srcNodeRef,"incremental")==""||dojo.attr(this.srcNodeRef,"incremental")=="true"){this.incremental=true;}else{this.incremental=false;}if(dojo.attr(this.srcNodeRef,"selection")!=undefined&&dojo.attr(this.srcNodeRef,"selection")=="open"){this.openSelection=true;}this.xfControl=dijit.byId(this.xfControlId);if(this.size==""||this.size<1){this.size=5;}},postCreate:function $DA4C_(){this.inherited(arguments);this.setCurrentValue();if(this.openSelection){dojo.addClass(this.xfControl.domNode,"xfSelectOpen");var _1=dojo.doc.createElement("div");dojo.addClass(_1,"xfSelectFreeText");var _2=dojo.doc.createElement("div");dojo.place(_2,_1);dojo.place(this.domNode,_1);dojo.place(_1,this.xfControl.domNode,1);this.freeTextDijit=new dijit.form.TextBox({},_2);dojo.connect(this.freeTextDijit,"_handleOnChange",this,"_textFieldValueChanged");}},_textFieldValueChanged:function $DA4D_(_3,_4){if(this.isServerUpdate){return;}else{this.freeTextValue=_3;this.setControlValue();}},_onFocus:function $DA4E_(){this.inherited(arguments);this.handleOnFocus();},_onBlur:function $DA4F_(){this.inherited(arguments);this.handleOnBlur();},applyState:function $DA4G_(){if(this.xfControl.isReadonly()){this.attr("disabled",true);if(this.openSelection){dojo.attr(this.freeTextDijit.domNode,"disabled",true);}}else{this.attr("disabled",false);if(this.openSelection){dojo.attr(this.freeTextDijit.domNode,"disabled",false);}}},getControlValue:function $DA4H_(){var _5=this.attr("value").join(" ");if(this.openSelection){if(this.freeTextValue==""&&_5==undefined){_5="";}else{if(this.freeTextValue!=""&&_5!=undefined&&_5!=""){_5=_5+" "+this.freeTextValue;}else{if(this.freeTextValue!=""){_5=this.freeTextValue;}}}}return _5;},onChange:function $DA4I_(_6){this.inherited(arguments);var _7=this.getSelected();var _8=undefined;dojo.forEach(_7,function(_9,_a,_b){var _c=dojo.attr(_9,"id");if(_8==undefined){_8=_c;}else{_8=_8+";"+_c;}});if(_8==undefined){_8="";}fluxProcessor.dispatchEventType(this.xfControl.id,"DOMActivate",_8);if(this.incremental){this.setControlValue();}},_handleSetControlValue:function $DA4J_(_d){var _e=new Array();_e=_d.split(" ");if(this.openSelection){var _f=dojo.query(".xfSelectorItem",this.domNode);var _10="";dojo.forEach(_e,function(_11,_12,_13){var _14=false;dojo.forEach(_f,function(_15,_16,_17){if(dojo.attr(_15,"value")==_11){_14=true;}});if(!_14){if(_10==undefined){_10=_11;}else{_10=_10+" "+_11;}}});this.freeTextValue=_10;this.isServerUpdate=true;this.freeTextDijit._setValueAttr(_10);this.isServerUpdate=false;}this._setValueAttr(_e);}});}