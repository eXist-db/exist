<project name="spatial-index">    
    
    <import file="../common.xml"/>
    
    <property name="resources.dir" value="./test/resources"/>
    <property name="lib.dir" value="./lib"/>
    
	<target name="prepare">
		<mkdir dir="${lib.dir}"/>
		<!-- geoapi-nogenerics-2.1-M3.jar -->
		<get src="http://lists.refractions.net/m2/org/geotools/gt2-api/2.4-M1/gt2-api-2.4-M1.jar" 
			dest="${lib.dir}/gt2-api-2.4-M1.jar" verbose="true" usetimestamp="true" />
		<!--
		Doesn't work and... 2.4-M1 isn't available any more !
		<get src="http://lists.refractions.net/m2/org/geotools/gt2-epsg-extension/2.4-M2/gt2-epsg-extension-2.4-M2.jar" 
			dest="${lib.dir}/gt2-epsg-extension-2.4-M2.jar" verbose="true" usetimestamp="true" />
		-->
	    <get src="http://lists.refractions.net/m2/org/geotools/gt2-epsg-wkt/2.4-M1/gt2-epsg-wkt-2.4-M1.jar" 
			dest="${lib.dir}/gt2-epsg-wkt-2.4-M1.jar" verbose="true" usetimestamp="true" />
		<get src="http://lists.refractions.net/m2/org/geotools/gt2-api/2.4-M1/gt2-api-2.4-M1.jar" 
			dest="${lib.dir}/gt2-api-2.4-M1.jar" verbose="true" usetimestamp="true" />
		<get src="http://lists.refractions.net/m2/org/geotools/gt2-main/2.4-M1/gt2-main-2.4-M1.jar"
			dest="${lib.dir}/gt2-main-2.4-M1.jar" verbose="true" usetimestamp="true" />
		<get src="http://lists.refractions.net/m2/org/geotools/gt2-metadata/2.4-M1/gt2-metadata-2.4-M1.jar" 
			dest="${lib.dir}/gt2-metadata-2.4-M1.jar" verbose="true" usetimestamp="true" />
		<get src="http://lists.refractions.net/m2/org/geotools/gt2-referencing/2.4-M1/gt2-referencing-2.4-M1.jar" 
			dest="${lib.dir}/gt2-referencing-2.4-M1.jar" verbose="true" usetimestamp="true" />
		<get src="http://lists.refractions.net/m2/org/geotools/gt2-xml/2.4-M1/gt2-xml-2.4-M1.jar" 
			dest="${lib.dir}/gt2-xml-2.4-M1.jar" verbose="true" usetimestamp="true" />
		<!-- hsqldb-1.8.0.7.jar -->
		<!-- jsr108-0.01.jar -->
		<!-- jts-1.8.jar -->
		<!-- vecmath-1.3.1.jar -->
	</target>

	<target name="jar" depends="compile">
        <jar destfile="${top.dir}/exist-modules.jar" basedir="${classes}"
             keepcompression="true" update="true"/>
    </target>
    
    <target name="prepare-test-tresources">
        <mkdir dir="${resources.dir}"/>
        <antcall target="download-port-talbot"/>
    </target>
    
    <available file="${resources.dir}/port-talbot.gml" property="port-talbot.present"/>
    
    <target name="download-port-talbot" unless="port-talbot.present">
        <get src="http://www.ordnancesurvey.co.uk/products/osmastermap/layers/topography/sampledata/2182-SS7886-2c1.gz" 
            dest="${resources.dir}/2182-SS7886-2c1.gz" verbose="true"/>
        <gunzip src="${resources.dir}/2182-SS7886-2c1.gz"  dest="${resources.dir}/port-talbot.gml"/>  
        <delete file="${resources.dir}/2182-SS7886-2c1.gz"/>
    </target>
    
    <target name="test" depends="compile-tests, prepare-test-tresources">        
        <!-- <junit fork="yes" haltonfailure="false" printsummary="yes" showoutput="${junit.output}" maxmemory="${junit.forked.VM.maxmemory}"> -->
        <junit fork="yes" haltonfailure="false" printsummary="yes" showoutput="${junit.output}" maxmemory="300m">

            <classpath refid="classpath.core"/>
            <classpath refid="classpath.junit"/>

            <formatter type="plain"/>
            <formatter type="xml"/>

            <test name="org.exist.indexing.spatial.AllIndexTests"
                todir="${junit.index.reports}" />
        </junit>
    </target>
</project>