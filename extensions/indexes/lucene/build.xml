<project name="lucene-index">

    <import file="../common.xml"/>

    <property name="lib.dir" value="./lib"/>

      <condition property="libs.available">
        <available file="${lib.dir}/lucene-core-2.3.2.jar"/>
      </condition>
    
    <target name="prepare-libs" unless="libs.available">
        <mkdir dir="${lib.dir}"/>
        <echo message="-----------------------------------------------------"/>
        <echo message="Downloading libraries required by the Lucene index..."/>
        <echo message="-----------------------------------------------------"/>
        <get src="http://repo1.maven.org/maven2/org/apache/lucene/lucene-core/2.3.2/lucene-core-2.3.2.jar" 
            dest="${lib.dir}/lucene-core-2.3.2.jar" verbose="true" usetimestamp="true" />
    </target>

    <target name="jar" depends="prepare-libs, compile">
        <jar destfile="${top.dir}/${lib.extensions}/exist-lucene-module.jar" basedir="${module.classes}">   
	        <manifest>
                <attribute name="Project-Name" value="${project.name}"/>
                <attribute name="Project-Version" value="${project.version}"/>
                <attribute name="Project-Build" value="${DSTAMP}"/>
                <attribute name="SVN-Revision" value="${svn.revision}"/>
            </manifest>
		</jar>
    </target>
	
    <target name="clean">
        <delete file="${top.dir}/${lib.extensions}/exist-lucene-module.jar"/>
        <delete dir="${module.classes}" failonerror="false"/>
        <delete dir="${test.classes}" failonerror="false"/>
    </target>
    
    <target name="test" depends="compile-tests">
        <junit fork="yes" haltonfailure="false" printsummary="yes" showoutput="${junit.output}" maxmemory="${junit.forked.VM.maxmemory}">

            <classpath refid="classpath.core"/>
            <classpath refid="classpath.junit"/>
    
            <formatter type="plain"/>
            <formatter type="xml"/>

            <test name="org.exist.indexing.lucene.LuceneIndexTest"
                todir="${junit.index.reports}"/>
        </junit>
    </target>
</project>

